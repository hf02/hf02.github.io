var Ut=Object.defineProperty;var gt=Object.getOwnPropertySymbols;var Ht=Object.prototype.hasOwnProperty,Yt=Object.prototype.propertyIsEnumerable;var ft=(n,t,e)=>t in n?Ut(n,t,{enumerable:!0,configurable:!0,writable:!0,value:e}):n[t]=e,nt=(n,t)=>{for(var e in t||(t={}))Ht.call(t,e)&&ft(n,e,t[e]);if(gt)for(var e of gt(t))Yt.call(t,e)&&ft(n,e,t[e]);return n};import{J as Xt,S as X,i as G,s as W,e as k,t as q,c as y,a as S,g as J,d as g,b as T,f as A,O as w,h as ot,j as z,l as I,N as O,R as Z,T as rt,u as bt,U as xt,V as Gt,W as F,X as Wt,Y as qt,Z as Jt,_ as Zt,$ as Qt,a0 as Kt,a1 as $t,a2 as te,a3 as ee,p as C,v as Q,w as K,x as $,a4 as se,n as L,A as tt,m as wt,o as vt,L as ie,M as Tt,a5 as kt,k as yt,P as St,Q as Dt,a6 as Mt,a7 as Ct,E as ne}from"../chunks/vendor-10aeeba5.js";import{T as N,a as R,b as B,d as Et,S as U,s as D,C as Pt,g as oe,c as re,u as ae,l as E,L as he,e as at}from"../chunks/LoadingScreen-bc5470f5.js";function le(n,t,e){return n.padEnd(e,t).slice(0,e)}function At(n){let t,e,s,i;return{c(){t=k("div"),e=q("! "),s=q(n[7]),this.h()},l(o){t=y(o,"DIV",{class:!0});var a=S(t);e=J(a,"! "),s=J(a,n[7]),a.forEach(g),this.h()},h(){T(t,"class",i="unstable "+(n[5]?"cooldown":"")+" svelte-1cip8ko")},m(o,a){A(o,t,a),w(t,e),w(t,s)},p(o,a){a&128&&ot(s,o[7]),a&32&&i!==(i="unstable "+(o[5]?"cooldown":"")+" svelte-1cip8ko")&&T(t,"class",i)},d(o){o&&g(t)}}}function ce(n){let t,e,s,i,o,a=(n[1]?n[3]:`${n[4]}
${n[3]}`)+"",l,_,h,m,p=(n[6]===!0||n[5]===!0)&&At(n);return{c(){t=k("div"),e=k("div"),s=k("div"),i=z(),o=k("div"),l=q(a),_=z(),h=k("canvas"),m=z(),p&&p.c(),this.h()},l(c){t=y(c,"DIV",{class:!0,style:!0});var r=S(t);e=y(r,"DIV",{class:!0});var d=S(e);s=y(d,"DIV",{class:!0,style:!0}),S(s).forEach(g),i=I(d),o=y(d,"DIV",{class:!0});var u=S(o);l=J(u,a),u.forEach(g),d.forEach(g),_=I(r),h=y(r,"CANVAS",{class:!0}),S(h).forEach(g),m=I(r),p&&p.l(r),r.forEach(g),this.h()},h(){T(s,"class","text-background svelte-1cip8ko"),O(s,"background","linear-gradient(180deg, "+n[0].bg+" 35%, #00000000 100%)"),T(o,"class","text-content svelte-1cip8ko"),T(e,"class","text svelte-1cip8ko"),T(h,"class","svelte-1cip8ko"),T(t,"class","panel svelte-1cip8ko"),O(t,"background-color",n[0].bg),O(t,"border-color",n[0].fg),O(t,"color",n[0].fg),Z(t,"compact",n[1])},m(c,r){A(c,t,r),w(t,e),w(e,s),w(e,i),w(e,o),w(o,l),w(t,_),w(t,h),n[8](h),w(t,m),p&&p.m(t,null)},p(c,[r]){r&1&&O(s,"background","linear-gradient(180deg, "+c[0].bg+" 35%, #00000000 100%)"),r&26&&a!==(a=(c[1]?c[3]:`${c[4]}
${c[3]}`)+"")&&ot(l,a),c[6]===!0||c[5]===!0?p?p.p(c,r):(p=At(c),p.c(),p.m(t,null)):p&&(p.d(1),p=null),r&1&&O(t,"background-color",c[0].bg),r&1&&O(t,"border-color",c[0].fg),r&1&&O(t,"color",c[0].fg),r&2&&Z(t,"compact",c[1])},i:rt,o:rt,d(c){c&&g(t),n[8](null),p&&p.d()}}}class zt extends N{constructor(t,e,s){super();this.name=t,this.fg=e,this.bg=s,this._min=1/0,this._max=0,this.graph_x=0,this.graph_y=0,this.graph_width=100,this.graph_total_height=70,this.graph_deadzone=50,this.graph_non_deadzone=this.graph_total_height-this.graph_deadzone,this._updateText=!0,this.dynamicMax=!1,this._alreadyUpdatedDynamicMax=!1,this._currentDynamicMax=0,this._dynamicMaxTicker=new R({method:B.Manual,rate:1e4}),this._dynamicMaxStartTicker=new R({method:B.Manual,rate:1e3}),this.showExtras=!0,this._last=[],this._average=0,this._viewAverage=0,this.unit="",this.text="",this.compactText="",this._unstable=!1,this._unstableCooldown=!1,this._unstableText="",this.updateCanvas(),this._dynamicMaxTicker.on("tick",()=>this.updateDynamicTick()),this._dynamicMaxTicker.start(),this._dynamicMaxStartTicker.once("tick",()=>{this._dynamicMaxStartTicker.stop(),this.updateDynamicTick()}),this._dynamicMaxStartTicker.start()}updateSize(){this._pixelRatio=1,this._graph_x=this.graph_x*this._pixelRatio,this._graph_y=this.graph_y*this._pixelRatio,this._graph_width=this.graph_width*this._pixelRatio,this._graph_height=this.graph_deadzone*this._pixelRatio,this._graph_deadzone=this.graph_non_deadzone*this._pixelRatio,this._graph_deadzone_percent=this._graph_deadzone/(this._graph_height+this._graph_deadzone),this._canvas.width=this._graph_width,this._canvas.height=this.graph_total_height}updateCanvas(t=document.createElement("canvas")){this._canvas=t,this._context=this._canvas.getContext("2d"),this.updateSize()}rerenderAll(t=this._last,e=this._average){for(let s=0;s<t.length;s++){const i=t[s];this.render(i,e)}}render(t,e=this._average,s=this.fg,i=this.bg){if(typeof t=="number"){this._context.drawImage(this._canvas,this._graph_x+this._pixelRatio,this._graph_y,this._graph_width-this._pixelRatio,this._graph_height+this._graph_deadzone,this._graph_x,this._graph_y,this._graph_width-this._pixelRatio,this._graph_height+this._graph_deadzone),this._context.fillStyle=s;const o=Math.floor(t/e*(this._graph_height+this._graph_deadzone));this._context.fillRect(this._graph_x+this._graph_width-this._pixelRatio,this._graph_y,this._pixelRatio,this._graph_height+this._graph_deadzone);const a=o*this._graph_deadzone_percent;this._context.fillStyle=i,this._context.fillRect(this._graph_x+this._graph_width-this._pixelRatio,this._graph_y,this._pixelRatio,this._graph_height+this._graph_deadzone-a)}}updateDynamicTick(){this._currentDynamicMax=this._average,this._alreadyUpdatedDynamicMax=!0,this.dynamicMax===!0&&this.render(10,1,"#FFF")}update(t,e=this._currentDynamicMax){if(this._last.push(t),this._last.length>this._graph_width&&this._last.shift(),this._average=Math.round(Xt.mean(this._last)),this._viewAverage<this._average?this._viewAverage++:this._viewAverage>this._average&&this._viewAverage--,(this._alreadyUpdatedDynamicMax||!this.dynamicMax)&&this.render(t,e),typeof t=="number"&&(this._min=Math.min(this._min,t),this._max=Math.max(this._max,t)),this._dynamicMaxTicker.manualCallback(),this._dynamicMaxStartTicker.manualCallback(),this._updateText){let s=function(i){return typeof i=="number"?Math.floor(i):i};this.showExtras===!1?(this.text=`${s(t)}`,this.compactText=this.text):(this.compactText=`${s(t)} ${this.unit}`,this.text=`${s(t)} ${this.unit}
(${s(this._min)} - ${s(this._max)})`)}this.emit("update",this._min,this._max,t)}get unstable(){return this._unstable}set unstable(t){t===!1&&this._unstable===!0&&(this._unstableCooldown=!0,clearTimeout(this._unstableCooldownTimeout),this._unstableCooldownTimeout=setTimeout(()=>{this._unstableCooldown=!1},5e3)),t===!0&&(clearTimeout(this._unstableCooldownTimeout),this._unstableCooldown=!1),this._unstable=t}get unstableCooldown(){return this._unstableCooldown}set unstableText(t){this.unstable&&(this._unstableText=t)}get unstableText(){return this._unstableText}}function ue(n,t,e){let{panel:s}=t,i,o="",a="",l;const _=Et(f=>{const V=f.debug.stats.spinner;switch(V){case U.Braille:l=["\u2807","\u280B","\u2819","\u2838","\u2834","\u2826"];break;case U.Line:l=["/","-","\\","|"];break;case U.Number:l=["0","1","2","3","4","5","6","7","8","9"];break;case U.Wiggle:l=["<","(","|",")",">",")","|","("];break;case U.Run:l=["\u2514(\u141B)\u2510","\u250C(\u141B)\u2518"];break;default:l=V;break}});let h=0;function m(f,V,ut){c?e(3,o=`${l[h%l.length]} ${s.compactText}`):e(3,o=`${l[h%l.length]} ${s.text}`),h++,e(4,a=s.name),e(6,d=s.unstable),e(7,u=s.unstableText),e(5,r=s.unstableCooldown)}bt(()=>{s.updateCanvas(i),m(),s.on("update",m)});function p(){s.removeListener("update",m),_(),e(0,s=null)}xt(p);let{compact:c=!1}=t,r=!1,d=!1,u="";function x(f){F[f?"unshift":"push"](()=>{i=f,e(2,i)})}return n.$$set=f=>{"panel"in f&&e(0,s=f.panel),"compact"in f&&e(1,c=f.compact)},n.$$.update=()=>{n.$$.dirty&1&&new Gt(s.bg).alpha(.5).string()},[s,c,i,o,a,r,d,u,x]}class de extends X{constructor(t){super();G(this,t,ue,ce,W,{panel:0,compact:1})}}function It(n,t,e=0){const s=Math.abs(n),i=s.toFixed();`${s}`.length-i.length;let o=i.length+e;const a=t;let l=!1;for(;o<a;){const h=s.toPrecision(o);if(h.length>=a){e===0&&h.indexOf(".")&&h.length>a&&(l=!0);break}o++}const _=n.toPrecision(o);return l?le(_,"0",t):_}function _e(n){return Object.getPrototypeOf(n).constructor}class ht{constructor(t,e=!1){this._dirty={},this._alreadyDirty=!0,this._caches=t,this._overkill=e}get dirty(){return Object.freeze(nt({},this._dirty))}get caches(){return Object.freeze(nt({},this._caches))}dirtyAll(){if(this._alreadyDirty===!1)for(const t in this._dirty)Object.prototype.hasOwnProperty.call(this._dirty,t)&&(this._dirty[t]=!0)}isOverkill(t){return D.performance.cache!==Pt.Extreme?typeof this._overkill=="boolean"?this._overkill:this._overkill[t]===!0:!1}getDirty(t){return[!0,void 0].includes(this._dirty[t])}setDirty(t,e){return this._dirty[t]=e,e===!1&&(this._alreadyDirty=!1),e}getValue(t){return this._caches[t]}setValue(t,e){return this._caches[t]=e,e}do(t,e){return this.getDirty(t)||D.performance.cache===Pt.None||this.isOverkill(t)?this.setValue(t,e()):this.getValue(t)}}class H extends N{constructor(t,e=null){super();this.vectorHelper=lt,this._axis=[],this._cache=new ht({readonlyAxis:null,length:null}),this._initDim=null,this._initDim=e,this._axis=this.vectorHelper.arrayize(t,e)}get axis(){return this._cache.do("readonlyAxis",()=>Object.freeze([...this._axis]))}get dimension(){return this._axis.length}set dimension(t){this.setDimension(t)}setDimension(t,e=0){if(this._initDim!==null)throw new Error("You can't change the dimension!");if(e===!0&&(e=this.dimension===1?this._axis[0]:0),t>this.dimension)for(let s=0;s<t;s++)this._axis[s]===void 0&&this._axis.push(e);else this._axis.length=t}clone(t=this._axis){return new(_e(this))(t)}setAxis(t,e){return this._axis[t]=e,this._onAxisChange(t),this}getAxis(t){return this._axis[t]}get length(){return this._cache.do("length",()=>this.vectorHelper.distance(this.clone(0),this))}set length(t){this.setNormalized(),this.setMul(t)}normalized(){const t=this.clone(),e=this.length;return t.setDiv(e),t}setNormalized(){return this.clone(this.normalized())}_onAxisChange(t){this.emit("change",t),this._cache.dirtyAll()}set(t){return this._axis=this.vectorHelper.arrayize(t),this._onAxisChange(null),this}calc(t,e){return this.vectorHelper.calc(this,t,e)}add(t){return this.vectorHelper.add(this,t)}sub(t){return this.vectorHelper.sub(this,t)}mul(t){return this.vectorHelper.mul(this,t)}div(t){return this.vectorHelper.div(this,t)}setCalc(t,e){return this.set(this.vectorHelper.calc(this,t,e))}setAdd(t){return this.set(this.add(t))}setSub(t){return this.set(this.sub(t))}setMul(t){return this.set(this.mul(t))}setDiv(t){return this.set(this.div(t))}}class lt{static arrayize(t,e){if(typeof t=="number"){const s=[t];if(e)for(let i=0;i<e-1;i++)s.push(t);return s}else return Array.isArray(t)?t:t?[...t.axis]:this.arrayize(0,e)}static distance(t,e){let s=0;const i=t.clone(),o=e.clone();i.dimension!==o.dimension&&(o.dimension=i.dimension);for(let a=0;a<i.axis.length;a++){const l=i.axis[a],_=o.axis[a];s+=(l-_)**2}return Math.sqrt(s)}static calc(t,e,s){const i=new H(t),o=new H(e),a=new H;o.dimension!==i.dimension&&o.setDimension(i.dimension,!0);for(let l=0;l<i.axis.length;l++){const _=i.axis[l],h=o.axis[l];a.setAxis(l,s(_,h))}return a}static add(t,e){return this.calc(t,e,(s,i)=>s+i)}static sub(t,e){return this.calc(t,e,(s,i)=>s-i)}static mul(t,e){return this.calc(t,e,(s,i)=>s*i)}static div(t,e){return this.calc(t,e,(s,i)=>s/i)}static axisNumberToString(t){switch(t){case 0:return"x";case 1:return"y";case 2:return"z";case 3:return"w";default:return t}}}class j extends H{constructor(t){super(t,2)}get x(){return this.getAxis(0)}set x(t){this.setAxis(0,t)}get y(){return this.getAxis(1)}set y(t){this.setAxis(1,t)}}class ct extends H{constructor(t){super(t,3)}get x(){return this.getAxis(0)}set x(t){this.setAxis(0,t)}get y(){return this.getAxis(1)}set y(t){this.setAxis(1,t)}get z(){return this.getAxis(2)}set z(t){this.setAxis(2,t)}}class me extends N{constructor(t){super();this._canvas=t,this.fixedTickerRate=1e3/20,this.maxDeltatime=1e3/19,this._crosshairShow=!1,this.inputController=new we(this._canvas,window,document,this),this._debugText=["..."],this._debugTextShort=["..."],this._lastButtonPressed=null,this._assets=new Te({models:{player:"/assets/models/player.gltf"}}),this._room=new ke,this._thing=new et,this._loaded=!1,this._started=!1}get crosshairShow(){return this._crosshairShow}set crosshairShow(t){t!==this._crosshairShow&&(this._crosshairShow,this.emit("crosshairUpdate",this.crosshairShow))}get debugText(){return this._debugText}get debugTextShort(){return this._debugTextShort}_getDebugPosition(t,e=10){return t.map(s=>It(s,e,3)).join(", ")}_getDebugRotation(t){return t.map(e=>It(e*(180/Math.PI),10,3)).join(", ")}_updateDebugText(){const t=this._rendering.camera,e=this._player;this._debugTextShort=[`${e.position.axis.map(s=>Math.floor(s)).join(", ")}`],this._debugText=[`player pos: ${this._getDebugPosition(e.position.axis)}`,`(${this._getDebugRotation(e.rotation.axis)})`,`cam pos: ${this._getDebugPosition(t.position.axis)}`,` (${this._getDebugRotation(t.rotation.axis)})`,`${(()=>{let s="";for(const i of Ot)s+=this.inputController.getInput(i)?xe[i]:"_";return s})()} ${this._lastButtonPressed}`,`${this.inputController.mouseLocked?"cam":"mus"} ${(()=>{const s=this.inputController.mouseLocked;let i="";return s?i+=this._getDebugPosition(this.inputController.getInput("camera").position.axis,7):i+=this._getDebugPosition(this.inputController.getInput("mouse").position.axis,7),i})()}`,...(()=>{const s=globalThis.ug13Watch,i=[];for(const o in s)if(Object.prototype.hasOwnProperty.call(s,o)){const a=s[o];i.push(`
    ${o}: ${a}`)}return i.unshift(`ug13Watch (${i.length}) = {`),i.push("}"),i})()]}get player(){return this._player}get loaded(){return this._loaded}get started(){return this._started}async load(t=()=>{}){t(0,2,"Loading settings","Checking"),await oe(),t(1,2,"Loading settings","Saving"),await re(),t(2,2,"Loading settings","Done"),t(0,1,"Setting up some things",""),this.frameTicker=new R({maxDeltaTime:this.maxDeltatime,method:B.RequestAnimationFrame});const e=D.performance.fixedTickerUndershoot;return e!==0?(this.fixedTicker=new R({method:B.Manual,rate:this.fixedTickerRate,undershoot:e,maxDeltaTime:this.maxDeltatime}),this.frameTicker.on("tick",()=>this.fixedTicker.manualCallback())):this.fixedTicker=new R({method:B.SetInterval,rate:this.fixedTickerRate,undershoot:e,maxDeltaTime:this.maxDeltatime}),this._rendering=new ve(this._canvas,this.frameTicker,this._assets,this._room),this._player=new pe(this._assets,this._room.world,this.inputController,this._rendering.camera,this),t(1,1,"Setting up some things","Done"),await this._assets.loadAssets(t),this._loaded=!0,this.emit("loaded"),this}async start(t){if(t(0,2,"Starting"),this._loaded===!1)throw new Error("Game can't start if it's not loaded.");t(0,2,"Starting","Setting up renderer"),await this._rendering.start(),t(1,2,"Starting","Setting up some things"),this.inputController.on("action1",s=>{s===!0&&this.inputController.lockPointer()}),this.inputController.on("pause",s=>{s===!0&&this.inputController.unlockPointer()}),this.inputController.listen(),this.inputController.on("buttonDown",s=>{this._lastButtonPressed=s.button}),this.frameTicker.start().on("tick",this._frameTick.bind(this)),this.fixedTicker.start().on("tick",this._fixedTick.bind(this)),this._updateSize(),window.addEventListener("resize",this._updateSize.bind(this));const e=this._thing;return this._room.world.add(e),this._thing.position.y=-1,this.inputController.on("debug",s=>{s===!0&&(D.debug.stats.show++,D.debug.stats.show>2&&(D.debug.stats.show=0)),ae()}),t(2,2,"Starting","Done"),this._started=!0,this.emit("started"),this}async stop(){throw new Error("not implemented")}_updateSize(){this._rendering.updateSize()}_frameTick(t){this._updateDebugText(),this.emit("frameTick",t)}_fixedTick(t){this.emit("fixedTick",t)}_setup(){throw new Error("not implemented")}_loadAssets(){throw new Error("not implemented")}}class et{constructor(){this._rendererObject=new Wt(new qt(1,1,1),new Jt({color:16711680})),this._parent=null,this.position=new ct,this.rotation=new ct,this.velocity=new ct,this._name="",this._rotationOrder="XYZ",this._cache=new ht({children:null}),this._children=[],this.position.on("change",t=>{this._processVectorChange("position",t)}),this.rotation.on("change",t=>{this._processVectorChange("rotation",t)})}get rotationOrder(){return this._rotationOrder}set rotationOrder(t){this._rotationOrder=t,this._rendererObject.rotation.order=t}toString(){return`[Thing ${this.name}]`}get parent(){return this._parent}set parent(t){this.changeParent(t)}get name(){return this._name}set name(t){this._name=t,this._rendererObject.name=t}_processVectorChange(t,e){if(e===null){const i=this[t].axis;for(let o=0;o<i.length;o++){const a=lt.axisNumberToString(o);this._rendererObject[t][a]=i[o]}}const s=lt.axisNumberToString(e);this._rendererObject[t][s]=this[t][s]}get children(){return this._cache.do("children",()=>Object.freeze([...this._children]))}get rendererObject(){return this._rendererObject}add(t){return t._children.push(t),this._rendererObject.add(t._rendererObject),this._cache.setDirty("children",!0),t.changeParent(this,!1),t}changeParent(t,e=!0){var s;e===!0&&((s=this.parent)==null||s.remove(this),t==null||t.add(this)),this._parent=t}remove(t){for(let e=0;e<this._children.length;e++)if(this._children[e]===t){this._children.splice(e,1);break}return t.changeParent(null,!1),this}getChildFromName(t){for(const e of this._children)if(e.name===t)return e;return null}}class pe extends et{constructor(t,e,s,i,o){super();this.model=t,this.world=e,this.input=s,this.camera=i,this.game=o,this.world.add(this),E("info",this),this._setupPlayerCamera(),this._subscribeToControls()}_setupPlayerCamera(){this.camera.parent=this,this.rotationOrder="YXZ"}_subscribeToControls(){this.input.on("camera",t=>{const e=D.input.camera.mouseSensitivity;this.rotation.x-=t.movement.y*e,this.rotation.y-=t.movement.x*e}),this.game.on("frameTick",t=>{const e=.01,s=Math.sin(this.rotation.y%(Math.PI*2)),i=Math.cos(this.rotation.y%(Math.PI*2)),o=Math.sin((this.rotation.y+Math.PI*.5)%(Math.PI*2)),a=Math.cos((this.rotation.y+Math.PI*.5)%(Math.PI*2));this.input.getInput("moveForwards")&&(this.position.x-=s*e*t,this.position.z-=i*e*t),this.input.getInput("moveBackwards")&&(this.position.x+=s*e*t,this.position.z+=i*e*t),this.input.getInput("moveLeft")&&(this.position.x-=o*e*t,this.position.z-=a*e*t),this.input.getInput("moveRight")&&(this.position.x+=o*e*t,this.position.z+=a*e*t)})}}class ge extends et{constructor(){super(...arguments);this._rendererObject=new Zt,this._aspect=1}get rendererObject(){return this._rendererObject}get aspect(){return this._aspect}set aspect(t){this._aspect=t,this._rendererObject.aspect=this.aspect}updateProjectionMatrix(){this._rendererObject.updateProjectionMatrix()}}class fe extends et{constructor(){super(...arguments);this._rendererObject=new Qt}get rendererObject(){return this._rendererObject}}class be extends N{constructor(t){super();this._element=t,this.ongoingTouches=[],this.ongoingTouchesDOM=[]}_setupEvents(){this._element.addEventListener("touchend",this._touchEndEvent.bind(this)),this._element.addEventListener("touchcancel",this._touchCancelEvent.bind(this)),this._element.addEventListener("touchmove",this._touchMoveEvent.bind(this)),this._element.addEventListener("touchstart",this._touchStartEvent.bind(this)),this.on("end",t=>this.emit("stop",t)),this.on("cancel",t=>this.emit("stop",t))}listen(){this._setupEvents()}_updateTouch(t,e){const s=this.ongoingTouches[t],i={id:t,rawTouch:e,movementX:s?e.clientX-s.rawTouch.clientX:0,movementY:s?e.clientY-s.rawTouch.clientY:0,posX:e.clientX,posY:e.clientY};return this.ongoingTouches[t]=i,this.ongoingTouchesDOM[e.identifier]=i,i}_deleteTouch(t){const e=this.ongoingTouches[t];return delete this.ongoingTouchesDOM[e.rawTouch.identifier],delete this.ongoingTouches[t],e}_createTouch(t){return this._updateTouch(this.ongoingTouches.length,t)}getDomId(t){var e;return(e=this.ongoingTouches[t])==null?void 0:e.rawTouch.identifier}getTouchControllerId(t){var e;return(e=this.ongoingTouchesDOM[t])==null?void 0:e.id}_touchStartEvent(t){t.preventDefault();for(let e=0;e<t.changedTouches.length;e++){const s=t.changedTouches[e];this.emit("start",this._createTouch(s))}}_touchEndEvent(t){t.preventDefault();for(let e=0;e<t.changedTouches.length;e++){const s=t.changedTouches[e];this.emit("end",this._deleteTouch(this.getTouchControllerId(s.identifier)))}}_touchCancelEvent(t){t.preventDefault();for(let e=0;e<t.changedTouches.length;e++){const s=t.changedTouches[e];this.emit("cancel",this._deleteTouch(this.getTouchControllerId(s.identifier)))}}_touchMoveEvent(t){t.preventDefault();for(let e=0;e<t.changedTouches.length;e++){const s=t.changedTouches[e];this.emit("move",this._updateTouch(this.getTouchControllerId(s.identifier),s))}}}const Ot=["jump","use","action1","action2","moveForwards","moveBackwards","moveLeft","moveRight","lookUp","lookDown","lookLeft","lookRight","pause","debug","fullscreen","zoom"],xe={action1:"1",action2:"2",camera:"C",debug:"D",jump:"J",mouse:"M",moveBackwards:"v",moveForwards:"^",moveLeft:"<",moveRight:">",lookDown:"v",lookLeft:"<",lookRight:">",lookUp:"^",pause:"P",use:"E",fullscreen:"F",zoom:"Z"};class we extends N{constructor(t,e=window,s=document,i){super();this._element=t,this._window=e,this._document=s,this._game=i,this.touchController=new be(this._element),this._cameraTouchId=null,this._mouseLocked=!1,this._inputs={mouse:{movement:new j,position:new j},camera:{movement:new j,position:new j}},this._assignmentToButtonCache=new ht({},!1),this._buttons={}}get element(){return this._element}get window(){return this._window}get document(){return this._document}get cameraTouchId(){return this._cameraTouchId}listen(){var t;this._setupEvents(),this.touchController.listen(),this.touchController.on("start",e=>{this._cameraTouchId===null&&(this._cameraTouchId=e.id),this._pointerLockChange(!0)}),this.touchController.on("stop",e=>{e.id===this._cameraTouchId&&(this._cameraTouchId=null)}),this.touchController.on("move",e=>{e.id===this._cameraTouchId&&this._mouseMove(new j([e.movementX,e.movementY]).setMul(D.input.camera.touchSensitivity))}),(t=this._game)==null||t.on("frameTick",e=>{const s=new j,i=D.input.camera.keyboardSensitivity*e;this.getInput("lookDown")&&s.setAdd([0,i]),this.getInput("lookUp")&&s.setAdd([0,-i]),this.getInput("lookRight")&&s.setAdd([i,0]),this.getInput("lookLeft")&&s.setAdd([-i,0]),this._cameraMove(s)})}_setupEvents(){this._element.addEventListener("mousedown",this._mouseDown.bind(this)),this._element.addEventListener("mouseup",this._mouseUp.bind(this)),this._window.addEventListener("keydown",this._keyDown.bind(this)),this._window.addEventListener("keyup",this._keyUp.bind(this)),this._element.addEventListener("contextmenu",this._contextMenu.bind(this)),this._window.addEventListener("blur",this._unfocus.bind(this)),this._window.addEventListener("mousemove",this._mouseMoveEvent.bind(this)),this._document.addEventListener("pointerlockchange",this._pointerLockChangeEvent.bind(this))}get mouseLocked(){return this._mouseLocked}_pointerLockChangeEvent(t){this._pointerLockChange()}_pointerLockChange(t=this.document.pointerLockElement===this._element){this._mouseLocked=t,this.emit("mouseLock",t)}get inputs(){return this._inputs}_mouseNumberToString(t){return`Mouse${t}`}_mouseDown(t){t.preventDefault(),this._buttonDown(this._mouseNumberToString(t.button))}_contextMenu(t){return t.preventDefault(),!1}_unfocus(){for(const t in this._inputs)Object.prototype.hasOwnProperty.call(this._inputs,t)&&Ot.includes(t)&&this._processButtonInputEvent(t,!1)}_mouseUp(t){t.preventDefault(),this._buttonUp(this._mouseNumberToString(t.button))}_keyDown(t){t.preventDefault(),this._buttonDown(t.code)}_keyUp(t){t.preventDefault(),this._buttonUp(t.code)}_buttonDown(t){this._processButtonEvent(t,!0)}_buttonUp(t){this._processButtonEvent(t,!1)}_processButtonInputEvent(t,e,s=D.input[t]){const i={button:s,mapped:t};e===!0?this.emit("buttonDown",i):this.emit("buttonUp",i),t!=="none"&&(this._inputs[t]=e,this.emit(t,e))}_getButtonInputFromButton(t){return this._assignmentToButtonCache.do(t,()=>{const e=D.input.keys;for(const s in e)if(Object.prototype.hasOwnProperty.call(e,s)&&e[s]===t)return s;return"none"})}_processButtonEvent(t,e){if(this._buttons[t]===e)return;this._buttons[t]=e;const s=this._getButtonInputFromButton(t);this._processButtonInputEvent(s,e,t)}_cameraMove(t){this._inputs.camera.movement.set(t),this._inputs.camera.position.setAdd(t),this.emit("camera",this._inputs.camera)}_mouseMoveEvent(t){this._mouseMove(new j([t.movementX,t.movementY]),new j([t.clientX,t.clientY]))}_mouseMove(t,e){this._inputs.mouse.movement.set(t),e?this._inputs.mouse.position.set(e):this._inputs.mouse.position.add(t),this._mouseLocked===!0&&this._cameraMove(this._inputs.mouse.movement),this.emit("mouse",this._inputs.mouse)}lockPointer(){this._element.requestPointerLock()}unlockPointer(){this._document.exitPointerLock()}getButtonDown(t){return this._buttons[t]===!0}getInput(t){const e=this._inputs[t];return e===void 0?!1:e}_removeEvents(){}}class ve{constructor(t,e,s,i){this._canvas=t,this._ticker=e,this._assets=s,this._room=i,this._canvasContext=this._canvas.getContext("webgl"),this.camera=new ge,this._resolution=1,this._room.world.add(this.camera)}set resolution(t){this._resolution=t,this.updateSize()}get resolution(){return this._resolution}setupRenderer(){E("dbug","setting up renderer..."),this._renderer=new Kt({context:this._canvasContext,antialias:!1}),E("dbug","done setting up renderer.")}async start(){return this.setupRenderer(),this.updateSize(),this._room.world.rendererObject.background=new $t(2236962),this._ticker.on("tick",this._frameTick.bind(this)),this}_frameTick(t){this._renderer.render(this._room.world.rendererObject,this.camera.rendererObject)}updateSize(){const t=innerWidth*this._resolution,e=innerHeight*this._resolution;return this._canvas.width=t,this._canvas.height=e,this._renderer.setSize(t,e),this.camera.aspect=t/e,this.camera.updateProjectionMatrix(),this}}class Te{constructor(t){this._assets=t,this.assets={models:{},images:{}}}async loadAssets(t){await this._loadAssets(t)}async _loadAssets(t){E("dbug","loading assets...");function e(a,l){let _=0,h=0;for(const m of s)m.loaded>m.total?(_+=m.total,E("warn",`an asset's amount loaded is more than its total! (${m.loaded}/${m.total})`)):_+=m.loaded,h+=m.total;t==null||t(_,h,"Downloading assets",`${l} ${a}`)}const s=[],i=this._assets.models;for(const a in i)if(Object.prototype.hasOwnProperty.call(i,a)){const l=i[a],_=te.extname(l);let h;switch(_){case".gltf":h=ee}if(h!==void 0){const m=new h,p={promise:Promise.resolve(),loaded:0,total:0};p.promise=m.loadAsync(l,c=>{p.loaded=c.loaded,p.total=c.total,e("model",_)}),p.promise.then(c=>{this.assets.models[a]=c}),s.push(p)}else{const m=new Error(`Unknown file type ${_} (${a})`);throw E("err!",m.message),m}}const o=s.map(a=>a.promise);await Promise.all(o),E("dbug","done loading assets",this.assets)}}class ke{constructor(){this.world=new fe}}function Lt(n,t,e){const s=n.slice();return s[7]=t[e],s}function jt(n,t,e){const s=n.slice();return s[10]=t[e],s[12]=e,s}function Rt(n){let t,e,s,i,o,a,l,_=n[1],h=[];for(let r=0;r<_.length;r+=1)h[r]=Bt(jt(n,_,r));const m=r=>L(h[r],1,1,()=>{h[r]=null});let p=n[0]?n[3]:n[4],c=[];for(let r=0;r<p.length;r+=1)c[r]=Vt(Lt(n,p,r));return{c(){t=k("div"),e=k("div");for(let r=0;r<h.length;r+=1)h[r].c();s=z(),i=k("div");for(let r=0;r<c.length;r+=1)c[r].c();this.h()},l(r){t=y(r,"DIV",{class:!0});var d=S(t);e=y(d,"DIV",{class:!0});var u=S(e);for(let f=0;f<h.length;f+=1)h[f].l(u);u.forEach(g),s=I(d),i=y(d,"DIV",{class:!0});var x=S(i);for(let f=0;f<c.length;f+=1)c[f].l(x);x.forEach(g),d.forEach(g),this.h()},h(){T(e,"class","panels svelte-1xg1opo"),T(i,"class","text svelte-1xg1opo"),T(t,"class",o="container "+(n[0]?"":"hidden")+" svelte-1xg1opo")},m(r,d){A(r,t,d),w(t,e);for(let u=0;u<h.length;u+=1)h[u].m(e,null);w(t,s),w(t,i);for(let u=0;u<c.length;u+=1)c[u].m(i,null);l=!0},p(r,d){if(n=r,d&3){_=n[1];let u;for(u=0;u<_.length;u+=1){const x=jt(n,_,u);h[u]?(h[u].p(x,d),C(h[u],1)):(h[u]=Bt(x),h[u].c(),C(h[u],1),h[u].m(e,null))}for(wt(),u=_.length;u<h.length;u+=1)m(u);vt()}if(d&25){p=n[0]?n[3]:n[4];let u;for(u=0;u<p.length;u+=1){const x=Lt(n,p,u);c[u]?c[u].p(x,d):(c[u]=Vt(x),c[u].c(),c[u].m(i,null))}for(;u<c.length;u+=1)c[u].d(1);c.length=p.length}(!l||d&1&&o!==(o="container "+(n[0]?"":"hidden")+" svelte-1xg1opo"))&&T(t,"class",o)},i(r){if(!l){for(let d=0;d<_.length;d+=1)C(h[d]);ie(()=>{a||(a=Tt(t,Dt,{duration:200,easing:St},!0)),a.run(1)}),l=!0}},o(r){h=h.filter(Boolean);for(let d=0;d<h.length;d+=1)L(h[d]);a||(a=Tt(t,Dt,{duration:200,easing:St},!1)),a.run(0),l=!1},d(r){r&&g(t),kt(h,r),kt(c,r),r&&a&&a.end()}}}function Bt(n){let t,e,s,i,o,a;return e=new de({props:{panel:n[10],compact:!n[0]}}),{c(){t=k("div"),Q(e.$$.fragment),s=z(),this.h()},l(l){t=y(l,"DIV",{class:!0});var _=S(t);K(e.$$.fragment,_),s=I(_),_.forEach(g),this.h()},h(){T(t,"class","panel "+(n[12]===0?"top":"")+" svelte-1xg1opo")},m(l,_){A(l,t,_),$(e,t,null),w(t,s),i=!0,o||(a=se(t,"click",n[6]),o=!0)},p(l,_){const h={};_&2&&(h.panel=l[10]),_&1&&(h.compact=!l[0]),e.$set(h)},i(l){i||(C(e.$$.fragment,l),i=!0)},o(l){L(e.$$.fragment,l),i=!1},d(l){l&&g(t),tt(e),o=!1,a()}}}function Vt(n){let t,e=n[7]+"",s;return{c(){t=k("span"),s=q(e),this.h()},l(i){t=y(i,"SPAN",{class:!0});var o=S(t);s=J(o,e),o.forEach(g),this.h()},h(){T(t,"class","line svelte-1xg1opo")},m(i,o){A(i,t,o),w(t,s)},p(i,o){o&25&&e!==(e=i[7]+"")&&ot(s,e)},d(i){i&&g(t)}}}function ye(n){let t,e,s=n[2]&&Rt(n);return{c(){s&&s.c(),t=yt()},l(i){s&&s.l(i),t=yt()},m(i,o){s&&s.m(i,o),A(i,t,o),e=!0},p(i,[o]){i[2]?s?(s.p(i,o),o&4&&C(s,1)):(s=Rt(i),s.c(),C(s,1),s.m(t.parentNode,t)):s&&(wt(),L(s,1,1,()=>{s=null}),vt())},i(i){e||(C(s),e=!0)},o(i){L(s),e=!1},d(i){s&&s.d(i),i&&g(t)}}}function Se(n,t,e){let{open:s=!1}=t,{active:i=!1}=t,{panels:o=[]}=t,{text:a=[]}=t,{textClosed:l=[]}=t;function _(m){e(1,o=[...o,m])}const h=m=>{m.preventDefault(),e(0,s=!s)};return n.$$set=m=>{"open"in m&&e(0,s=m.open),"active"in m&&e(2,i=m.active),"panels"in m&&e(1,o=m.panels),"text"in m&&e(3,a=m.text),"textClosed"in m&&e(4,l=m.textClosed)},[s,o,i,a,l,_,h]}class De extends X{constructor(t){super();G(this,t,Se,ye,W,{open:0,active:2,panels:1,text:3,textClosed:4,addPanel:5})}get addPanel(){return this.$$.ctx[5]}}class Ft extends zt{constructor(...t){super(...t);this._lowestThisSection=1/0,this._highestThisSection=0,this._TPSTicker=new R({method:B.Manual,rate:1e3}),this.showExtras=!0,this._updateText=!1,this._TPSTicker.start(),this.on("update",(e,s,i)=>{this._lowestThisSection>i?this._lowestThisSection=i:this._highestThisSection<i&&(this._highestThisSection=i),this._TPSTicker.manualCallback()}),this._TPSTicker.on("tick",()=>this.updateText())}updateText(){this.text="";function t(s){return typeof s=="number"?Math.floor(s):s}const e=`${t(this._lowestThisSection)}/${t(this._highestThisSection)}`;this.compactText=`${e} ${this.unit}`,this.text=`${e} ${this.unit}
(${t(this._min)} - ${t(this._max)})`,this._lowestThisSection=1/0,this._highestThisSection=0}}function Me(n){let t,e,s,i,o,a,l,_,h;i=new he({props:{show:n[4],info:n[2],percent:n[3],title:n[1],error:n[5]}});function m(r){n[14](r)}function p(r){n[15](r)}let c={text:n[9],textClosed:n[10]};return n[8]!==void 0&&(c.open=n[8]),n[7]!==void 0&&(c.active=n[7]),a=new De({props:c}),n[13](a),F.push(()=>Mt(a,"open",m)),F.push(()=>Mt(a,"active",p)),{c(){t=k("main"),e=k("canvas"),s=z(),Q(i.$$.fragment),o=z(),Q(a.$$.fragment),this.h()},l(r){t=y(r,"MAIN",{class:!0});var d=S(t);e=y(d,"CANVAS",{id:!0,class:!0}),S(e).forEach(g),s=I(d),K(i.$$.fragment,d),o=I(d),K(a.$$.fragment,d),d.forEach(g),this.h()},h(){T(e,"id","canvas"),T(e,"class","svelte-1nlk8s4"),T(t,"class","svelte-1nlk8s4"),Z(t,"noSelect",n[11])},m(r,d){A(r,t,d),w(t,e),n[12](e),w(t,s),$(i,t,null),w(t,o),$(a,t,null),h=!0},p(r,[d]){const u={};d&16&&(u.show=r[4]),d&4&&(u.info=r[2]),d&8&&(u.percent=r[3]),d&2&&(u.title=r[1]),d&32&&(u.error=r[5]),i.$set(u);const x={};d&512&&(x.text=r[9]),d&1024&&(x.textClosed=r[10]),!l&&d&256&&(l=!0,x.open=r[8],Ct(()=>l=!1)),!_&&d&128&&(_=!0,x.active=r[7],Ct(()=>_=!1)),a.$set(x),d&2048&&Z(t,"noSelect",r[11])},i(r){h||(C(i.$$.fragment,r),C(a.$$.fragment,r),h=!0)},o(r){L(i.$$.fragment,r),L(a.$$.fragment,r),h=!1},d(r){r&&g(t),n[12](null),tt(i),n[13](null),tt(a)}}}function Ce(n,t,e){xt(()=>{});let s,i="Downloading webpage",o="",a=0,l=!0,_=!0,h=!1,m,p=!1,c=!1,r=["xyz: 0, 0, 0"],d=["0, 0, 0"];bt(()=>{(async()=>{const v=new me(s);v.on("started",()=>{_!==!1&&(e(4,l=!1),e(1,i="Done"),e(2,o=""),_=!1)});function dt(b,P,Y,it){_!==!1&&(e(3,a=b/P),e(1,i=Y),e(2,o=it),E("dbug","loading update: "+i+((o!=null?o:!1)?` (${o})`:"")+` ${Math.floor(a*100)}%`))}try{await v.load(dt.bind(this)),await v.start(dt.bind(this))}catch(b){e(1,i="Failed"),e(2,o=`${b}`),_=!1,e(5,h=!0),E("err!","error loading/starting game:",b);return}Et(b=>{switch(b.debug.stats.show){case at.No:e(7,p=!1),e(8,c=!1);break;case at.Collapsed:e(7,p=!0),e(8,c=!1);break;case at.Open:e(7,p=!0),e(8,c=!0);break}e(11,u=b.video.noSelect)});const st=new Ft("Frame TPS","#0FF","#022"),_t=new Ft("Fixed TPS","#FF0","#220"),M=new zt("Memory","#F0F","#202");m.addPanel(st),m.addPanel(_t),m.addPanel(M),M.unit="MB";function mt(b){return Math.floor(1e3/b)}function Nt(){if(performance.memory){M.update(performance.memory.usedJSHeapSize*1e-6),M.showExtras=!0;const b=performance.memory.usedJSHeapSize/performance.memory.jsHeapSizeLimit;M.dynamicMax=!0,M.unstable=b>.5,M.unstableText=`${Math.floor(b*100)}% usage`}else M.update(`???
No memory
support`),M.dynamicMax=!1,M.showExtras=!1}st.dynamicMax=!0;function pt(b,P,Y,it){b.update(mt(Y),it),b.unstable=P!==Y,b.unstableText=`faking ${mt(P)}TPS`}v.frameTicker.on("tick",(b,P)=>{pt(st,b,P),e(9,r=v.debugText),e(10,d=v.debugTextShort)}),v.fixedTicker.on("tick",(b,P)=>{pt(_t,b,P,20),Nt()})})()});let u=!1;function x(v){F[v?"unshift":"push"](()=>{s=v,e(0,s)})}function f(v){F[v?"unshift":"push"](()=>{m=v,e(6,m)})}function V(v){c=v,e(8,c)}function ut(v){p=v,e(7,p)}return[s,i,o,a,l,h,m,p,c,r,d,u,x,f,V,ut]}class Ee extends X{constructor(t){super();G(this,t,Ce,Me,W,{})}}function Pe(n){let t,e,s;return e=new Ee({}),{c(){t=z(),Q(e.$$.fragment),this.h()},l(i){ne('[data-svelte="svelte-4vcxiu"]',document.head).forEach(g),t=I(i),K(e.$$.fragment,i),this.h()},h(){document.title="..."},m(i,o){A(i,t,o),$(e,i,o),s=!0},p:rt,i(i){s||(C(e.$$.fragment,i),s=!0)},o(i){L(e.$$.fragment,i),s=!1},d(i){i&&g(t),tt(e,i)}}}class Oe extends X{constructor(t){super();G(this,t,null,Pe,W,{})}}export{Oe as default};
