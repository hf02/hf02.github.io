import{J as At,S as G,i as W,s as H,e as T,t as X,c as S,a as y,g as Y,d as f,b as x,f as L,O as k,h as st,j as I,l as O,N as j,R as q,T as it,u as dt,U as _t,V as Bt,W as U,X as Ft,Y as Ut,Z as Vt,_ as Nt,$ as Gt,a0 as Wt,a1 as Ht,a2 as Xt,a3 as Yt,p as P,v as J,w as Z,x as Q,a4 as qt,n as R,A as K,m as mt,o as pt,L as Jt,M as ft,a5 as gt,k as bt,P as wt,Q as kt,a6 as vt,a7 as xt,E as Zt}from"../chunks/vendor-10aeeba5.js";import{T as nt,a as A,b as B,d as Tt,S as V,g as Qt,s as Kt,c as z,u as $t,V as ot,C as St,A as yt,l as D,e as C,L as te,f as at}from"../chunks/LoadingScreen-59a7b28f.js";function ee(n,t,e){return n.padEnd(e,t).slice(0,e)}function Mt(n){let t,e,s,i;return{c(){t=T("div"),e=X("! "),s=X(n[7]),this.h()},l(o){t=S(o,"DIV",{class:!0});var r=y(t);e=Y(r,"! "),s=Y(r,n[7]),r.forEach(f),this.h()},h(){x(t,"class",i="unstable "+(n[5]?"cooldown":"")+" svelte-1cip8ko")},m(o,r){L(o,t,r),k(t,e),k(t,s)},p(o,r){r&128&&st(s,o[7]),r&32&&i!==(i="unstable "+(o[5]?"cooldown":"")+" svelte-1cip8ko")&&x(t,"class",i)},d(o){o&&f(t)}}}function se(n){let t,e,s,i,o,r=(n[1]?n[3]:`${n[4]}
${n[3]}`)+"",u,m,h,_,p=(n[6]===!0||n[5]===!0)&&Mt(n);return{c(){t=T("div"),e=T("div"),s=T("div"),i=I(),o=T("div"),u=X(r),m=I(),h=T("canvas"),_=I(),p&&p.c(),this.h()},l(l){t=S(l,"DIV",{class:!0,style:!0});var a=y(t);e=S(a,"DIV",{class:!0});var d=y(e);s=S(d,"DIV",{class:!0,style:!0}),y(s).forEach(f),i=O(d),o=S(d,"DIV",{class:!0});var c=y(o);u=Y(c,r),c.forEach(f),d.forEach(f),m=O(a),h=S(a,"CANVAS",{class:!0}),y(h).forEach(f),_=O(a),p&&p.l(a),a.forEach(f),this.h()},h(){x(s,"class","text-background svelte-1cip8ko"),j(s,"background","linear-gradient(180deg, "+n[0].bg+" 35%, #00000000 100%)"),x(o,"class","text-content svelte-1cip8ko"),x(e,"class","text svelte-1cip8ko"),x(h,"class","svelte-1cip8ko"),x(t,"class","panel svelte-1cip8ko"),j(t,"background-color",n[0].bg),j(t,"border-color",n[0].fg),j(t,"color",n[0].fg),q(t,"compact",n[1])},m(l,a){L(l,t,a),k(t,e),k(e,s),k(e,i),k(e,o),k(o,u),k(t,m),k(t,h),n[8](h),k(t,_),p&&p.m(t,null)},p(l,[a]){a&1&&j(s,"background","linear-gradient(180deg, "+l[0].bg+" 35%, #00000000 100%)"),a&26&&r!==(r=(l[1]?l[3]:`${l[4]}
${l[3]}`)+"")&&st(u,r),l[6]===!0||l[5]===!0?p?p.p(l,a):(p=Mt(l),p.c(),p.m(t,null)):p&&(p.d(1),p=null),a&1&&j(t,"background-color",l[0].bg),a&1&&j(t,"border-color",l[0].fg),a&1&&j(t,"color",l[0].fg),a&2&&q(t,"compact",l[1])},i:it,o:it,d(l){l&&f(t),n[8](null),p&&p.d()}}}class Pt extends nt{constructor(t,e,s){super();this.name=t,this.fg=e,this.bg=s,this._min=1/0,this._max=0,this.graph_x=0,this.graph_y=0,this.graph_width=100,this.graph_total_height=70,this.graph_deadzone=50,this.graph_non_deadzone=this.graph_total_height-this.graph_deadzone,this._updateText=!0,this.dynamicMax=!1,this._alreadyUpdatedDynamicMax=!1,this._currentDynamicMax=0,this._dynamicMaxTicker=new A({method:B.Manual,rate:1e4}),this._dynamicMaxStartTicker=new A({method:B.Manual,rate:1e3}),this.showExtras=!0,this._last=[],this._average=0,this._viewAverage=0,this.unit="",this.text="",this.compactText="",this._unstable=!1,this._unstableCooldown=!1,this._unstableText="",this.updateCanvas(),this._dynamicMaxTicker.on("tick",()=>this.updateDynamicTick()),this._dynamicMaxTicker.start(),this._dynamicMaxStartTicker.once("tick",()=>{this._dynamicMaxStartTicker.stop(),this.updateDynamicTick()}),this._dynamicMaxStartTicker.start()}updateSize(){this._pixelRatio=1,this._graph_x=this.graph_x*this._pixelRatio,this._graph_y=this.graph_y*this._pixelRatio,this._graph_width=this.graph_width*this._pixelRatio,this._graph_height=this.graph_deadzone*this._pixelRatio,this._graph_deadzone=this.graph_non_deadzone*this._pixelRatio,this._graph_deadzone_percent=this._graph_deadzone/(this._graph_height+this._graph_deadzone),this._canvas.width=this._graph_width,this._canvas.height=this.graph_total_height}updateCanvas(t=document.createElement("canvas")){this._canvas=t,this._context=this._canvas.getContext("2d"),this.updateSize()}rerenderAll(t=this._last,e=this._average){for(let s=0;s<t.length;s++){const i=t[s];this.render(i,e)}}render(t,e=this._average,s=this.fg,i=this.bg){if(typeof t=="number"){this._context.drawImage(this._canvas,this._graph_x+this._pixelRatio,this._graph_y,this._graph_width-this._pixelRatio,this._graph_height+this._graph_deadzone,this._graph_x,this._graph_y,this._graph_width-this._pixelRatio,this._graph_height+this._graph_deadzone),this._context.fillStyle=s;const o=Math.floor(t/e*(this._graph_height+this._graph_deadzone));this._context.fillRect(this._graph_x+this._graph_width-this._pixelRatio,this._graph_y,this._pixelRatio,this._graph_height+this._graph_deadzone);const r=o*this._graph_deadzone_percent;this._context.fillStyle=i,this._context.fillRect(this._graph_x+this._graph_width-this._pixelRatio,this._graph_y,this._pixelRatio,this._graph_height+this._graph_deadzone-r)}}updateDynamicTick(){this._currentDynamicMax=this._average,this._alreadyUpdatedDynamicMax=!0,this.dynamicMax===!0&&this.render(10,1,"#FFF")}update(t,e=this._currentDynamicMax){if(this._last.push(t),this._last.length>this._graph_width&&this._last.shift(),this._average=Math.round(At.mean(this._last)),this._viewAverage<this._average?this._viewAverage++:this._viewAverage>this._average&&this._viewAverage--,(this._alreadyUpdatedDynamicMax||!this.dynamicMax)&&this.render(t,e),typeof t=="number"&&(this._min=Math.min(this._min,t),this._max=Math.max(this._max,t)),this._dynamicMaxTicker.manualCallback(),this._dynamicMaxStartTicker.manualCallback(),this._updateText){let s=function(i){return typeof i=="number"?Math.floor(i):i};this.showExtras===!1?(this.text=`${s(t)}`,this.compactText=this.text):(this.compactText=`${s(t)} ${this.unit}`,this.text=`${s(t)} ${this.unit}
(${s(this._min)} - ${s(this._max)})`)}this.emit("update",this._min,this._max,t)}get unstable(){return this._unstable}set unstable(t){t===!1&&this._unstable===!0&&(this._unstableCooldown=!0,clearTimeout(this._unstableCooldownTimeout),this._unstableCooldownTimeout=setTimeout(()=>{this._unstableCooldown=!1},5e3)),t===!0&&(clearTimeout(this._unstableCooldownTimeout),this._unstableCooldown=!1),this._unstable=t}get unstableCooldown(){return this._unstableCooldown}set unstableText(t){this.unstable&&(this._unstableText=t)}get unstableText(){return this._unstableText}}function ie(n,t,e){let{panel:s}=t,i,o="",r="",u;const m=Tt(g=>{const F=g.debug.stats.spinner;switch(F){case V.Braille:u=["\u2807","\u280B","\u2819","\u2838","\u2834","\u2826"];break;case V.Line:u=["/","-","\\","|"];break;case V.Number:u=["0","1","2","3","4","5","6","7","8","9"];break;case V.Wiggle:u=["<","(","|",")",">",")","|","("];break;case V.Run:u=["\u2514(\u141B)\u2510","\u250C(\u141B)\u2518"];break;default:u=F;break}});let h=0;function _(g,F,rt){l?e(3,o=`${u[h%u.length]} ${s.compactText}`):e(3,o=`${u[h%u.length]} ${s.text}`),h++,e(4,r=s.name),e(6,d=s.unstable),e(7,c=s.unstableText),e(5,a=s.unstableCooldown)}dt(()=>{s.updateCanvas(i),_(),s.on("update",_)});function p(){s.removeListener("update",_),m(),e(0,s=null)}_t(p);let{compact:l=!1}=t,a=!1,d=!1,c="";function w(g){U[g?"unshift":"push"](()=>{i=g,e(2,i)})}return n.$$set=g=>{"panel"in g&&e(0,s=g.panel),"compact"in g&&e(1,l=g.compact)},n.$$.update=()=>{n.$$.dirty&1&&new Bt(s.bg).alpha(.5).string()},[s,l,i,o,r,a,d,c,w]}class ne extends G{constructor(t){super();W(this,t,ie,se,H,{panel:0,compact:1})}}function Dt(n,t,e=0){const s=Math.abs(n),i=s.toFixed();`${s}`.length-i.length;let o=i.length+e;const r=t;let u=!1;for(;;){const h=s.toPrecision(o);if(h.length>=r){e===0&&h.indexOf(".")&&h.length>r&&(u=!0);break}o++}const m=n.toPrecision(o);return u?ee(m,"0",t):m}class oe extends nt{constructor(t){super();this._canvas=t,this.fixedTickerRate=1e3/20,this.maxDeltatime=1e3/19,this._crosshairShow=!1,this.inputController=new ce(this._canvas,window,document,this),this._debugText=["..."],this._debugTextShort=["..."],this._lastButtonPressed=null,this._assets=new de({models:{player:"/assets/models/player.gltf"}}),this._room=new _e,this._thing=new $,this._loaded=!1,this._started=!1}get crosshairShow(){return this._crosshairShow}set crosshairShow(t){t!==this._crosshairShow&&(this._crosshairShow,this.emit("crosshairUpdate",this.crosshairShow))}get debugText(){return this._debugText}get debugTextShort(){return this._debugTextShort}_getDebugPosition(t,e=10){return t.map(s=>Dt(s,e,3)).join(", ")}_getDebugRotation(t){return t.map(e=>Dt(e*(180/Math.PI),10,3)).join(", ")}_updateDebugText(){const t=this._rendering.camera,e=this._player;this._debugTextShort=[`${e.position.axis.map(s=>Math.floor(s)).join(", ")}`],this._debugText=[`player pos: ${this._getDebugPosition(e.position.axis)}`,`(${this._getDebugRotation(e.rotation.axis)})`,`cam pos: ${this._getDebugPosition(t.position.axis)}`,` (${this._getDebugRotation(t.rotation.axis)})`,`${(()=>{let s="";for(const i of Ct)s+=this.inputController.getInput(i)?le[i]:"_";return s})()} ${this._lastButtonPressed}`,`${this.inputController.mouseLocked?"cam":"mus"} ${(()=>{const s=this.inputController.mouseLocked;let i="";return s?i+=this._getDebugPosition(this.inputController.getInput("camera").position.axis,7):i+=this._getDebugPosition(this.inputController.getInput("mouse").position.axis,7),i})()}`,...(()=>{const s=globalThis.ug13Watch,i=[];for(const o in s)if(Object.prototype.hasOwnProperty.call(s,o)){const r=s[o];i.push(`
    ${o}: ${r}`)}return i.unshift(`ug13Watch (${i.length}) = {`),i.push("}"),i})()]}get player(){return this._player}get loaded(){return this._loaded}get started(){return this._started}async load(t=()=>{}){t(0,2,"Loading settings","Checking"),await Qt(),t(1,2,"Loading settings","Saving"),await Kt(),t(2,2,"Loading settings","Done"),t(0,1,"Setting up some things",""),this.frameTicker=new A({maxDeltaTime:this.maxDeltatime,method:B.RequestAnimationFrame});const e=z.performance.fixedTickerUndershoot;return e!==0?(this.fixedTicker=new A({method:B.Manual,rate:this.fixedTickerRate,undershoot:e,maxDeltaTime:this.maxDeltatime}),this.frameTicker.on("tick",()=>this.fixedTicker.manualCallback())):this.fixedTicker=new A({method:B.SetInterval,rate:this.fixedTickerRate,undershoot:e,maxDeltaTime:this.maxDeltatime}),this._rendering=new ue(this._canvas,this.frameTicker,this._assets,this._room),this._player=new ae(this._assets,this._room.world,this.inputController,this._rendering.camera,this),t(1,1,"Setting up some things","Done"),await this._assets.loadAssets(t),this._loaded=!0,this.emit("loaded"),this}async start(t){if(t(0,2,"Starting"),this._loaded===!1)throw new Error("Game can't start if it's not loaded.");t(0,2,"Starting","Setting up renderer"),await this._rendering.start(),t(1,2,"Starting","Setting up some things"),this.inputController.on("action1",s=>{s===!0&&this.inputController.lockPointer()}),this.inputController.on("pause",s=>{s===!0&&this.inputController.unlockPointer()}),this.inputController.listen(),this.inputController.on("buttonDown",s=>{this._lastButtonPressed=s.button}),this.frameTicker.start().on("tick",this._frameTick.bind(this)),this.fixedTicker.start().on("tick",this._fixedTick.bind(this)),this._updateSize(),window.addEventListener("resize",this._updateSize.bind(this));const e=this._thing;return this._room.world.add(e),this._thing.position.y=-1,this.inputController.on("debug",s=>{s===!0&&(z.debug.stats.show++,z.debug.stats.show>2&&(z.debug.stats.show=0)),$t()}),t(2,2,"Starting","Done"),this._started=!0,this.emit("started"),this}async stop(){throw new Error("not implemented")}_updateSize(){this._rendering.updateSize()}_frameTick(t){this._updateDebugText(),this.emit("frameTick",t)}_fixedTick(t){this.emit("fixedTick",t)}_setup(){throw new Error("not implemented")}_loadAssets(){throw new Error("not implemented")}}class ${constructor(){this._rendererObject=new Ft(new Ut(1,1,1),new Vt({color:16711680})),this._parent=null,this.position=new ot,this.rotation=new ot,this.velocity=new ot,this._name="",this._rotationOrder="XYZ",this._cache=new St({children:null}),this._children=[],this.position.on("change",t=>{this._processVectorChange("position",t)}),this.rotation.on("change",t=>{this._processVectorChange("rotation",t)})}get rotationOrder(){return this._rotationOrder}set rotationOrder(t){this._rotationOrder=t,this._rendererObject.rotation.order=t}toString(){return`[Thing ${this.name}]`}get parent(){return this._parent}set parent(t){this.changeParent(t)}get name(){return this._name}set name(t){this._name=t,this._rendererObject.name=t}_processVectorChange(t,e){if(e===null){const i=this[t].axis;for(let o=0;o<i.length;o++){const r=yt.axisNumberToString(o);this._rendererObject[t][r]=i[o]}}const s=yt.axisNumberToString(e);this._rendererObject[t][s]=this[t][s]}get children(){return this._cache.do("children",()=>Object.freeze([...this._children]))}get rendererObject(){return this._rendererObject}add(t){return t._children.push(t),this._rendererObject.add(t._rendererObject),this._cache.setDirty("children",!0),t.changeParent(this,!1),t}changeParent(t,e=!0){var s;e===!0&&((s=this.parent)==null||s.remove(this),t==null||t.add(this)),this._parent=t}remove(t){for(let e=0;e<this._children.length;e++)if(this._children[e]===t){this._children.splice(e,1);break}return t.changeParent(null,!1),this}getChildFromName(t){for(const e of this._children)if(e.name===t)return e;return null}}class ae extends ${constructor(t,e,s,i,o){super();this.model=t,this.world=e,this.input=s,this.camera=i,this.game=o,this.world.add(this),D("info",this),this._setupPlayerCamera(),this._subscribeToControls()}_setupPlayerCamera(){this.camera.parent=this,this.rotationOrder="YXZ"}_subscribeToControls(){this.input.on("camera",t=>{const e=z.input.camera.mouseSensitivity;this.rotation.x-=t.movement.y*e,this.rotation.y-=t.movement.x*e}),this.game.on("frameTick",t=>{const e=.01,s=Math.sin(this.rotation.y%(Math.PI*2)),i=Math.cos(this.rotation.y%(Math.PI*2)),o=Math.sin((this.rotation.y+Math.PI*.5)%(Math.PI*2)),r=Math.cos((this.rotation.y+Math.PI*.5)%(Math.PI*2));this.input.getInput("moveForwards")&&(this.position.x-=s*e*t,this.position.z-=i*e*t),this.input.getInput("moveBackwards")&&(this.position.x+=s*e*t,this.position.z+=i*e*t),this.input.getInput("moveLeft")&&(this.position.x-=o*e*t,this.position.z-=r*e*t),this.input.getInput("moveRight")&&(this.position.x+=o*e*t,this.position.z+=r*e*t)})}}class re extends ${constructor(){super(...arguments);this._rendererObject=new Nt,this._aspect=1}get rendererObject(){return this._rendererObject}get aspect(){return this._aspect}set aspect(t){this._aspect=t,this._rendererObject.aspect=this.aspect}updateProjectionMatrix(){this._rendererObject.updateProjectionMatrix()}}class he extends ${constructor(){super(...arguments);this._rendererObject=new Gt}get rendererObject(){return this._rendererObject}}const Ct=["jump","use","action1","action2","moveForwards","moveBackwards","moveLeft","moveRight","lookUp","lookDown","lookLeft","lookRight","pause","debug","fullscreen","zoom"],le={action1:"1",action2:"2",camera:"C",debug:"D",jump:"J",mouse:"M",moveBackwards:"v",moveForwards:"^",moveLeft:"<",moveRight:">",lookDown:"v",lookLeft:"<",lookRight:">",lookUp:"^",pause:"P",use:"E",fullscreen:"F",zoom:"Z"};class ce extends nt{constructor(t,e=window,s=document,i){super();this._element=t,this._window=e,this._document=s,this._game=i,this._mouseLocked=!1,this._inputs={mouse:{movement:new C,position:new C},camera:{movement:new C,position:new C}},this._assignmentToButtonCache=new St({},!1),this._buttons={}}get element(){return this._element}get window(){return this._window}get document(){return this._document}listen(){var t;this._setupEvents(),(t=this._game)==null||t.on("frameTick",e=>{const s=new C,i=z.input.camera.keyboardSensitivity*e;this.getInput("lookDown")&&s.add([0,i]),this.getInput("lookUp")&&s.add([0,-i]),this.getInput("lookRight")&&s.add([i,0]),this.getInput("lookLeft")&&s.add([-i,0]),this._cameraMove(s)})}_setupEvents(){this._element.addEventListener("mousedown",this._mouseDown.bind(this)),this._element.addEventListener("mouseup",this._mouseUp.bind(this)),this._window.addEventListener("keydown",this._keyDown.bind(this)),this._window.addEventListener("keyup",this._keyUp.bind(this)),this._element.addEventListener("contextmenu",this._contextMenu.bind(this)),this._window.addEventListener("blur",this._unfocus.bind(this)),this._window.addEventListener("mousemove",this._mouseMove.bind(this)),this._document.addEventListener("pointerlockchange",this._pointerLockChange.bind(this))}get mouseLocked(){return this._mouseLocked}_pointerLockChange(){this._mouseLocked=this.document.pointerLockElement===this._element,this.emit("mouseLock",this._mouseLocked)}get inputs(){return this._inputs}_mouseNumberToString(t){return`Mouse${t}`}_mouseDown(t){t.preventDefault(),this._buttonDown(this._mouseNumberToString(t.button))}_contextMenu(t){return t.preventDefault(),!1}_unfocus(){for(const t in this._inputs)Object.prototype.hasOwnProperty.call(this._inputs,t)&&Ct.includes(t)&&this._processButtonInputEvent(t,!1)}_mouseUp(t){t.preventDefault(),this._buttonUp(this._mouseNumberToString(t.button))}_keyDown(t){t.preventDefault(),this._buttonDown(t.code)}_keyUp(t){t.preventDefault(),this._buttonUp(t.code)}_buttonDown(t){this._processButtonEvent(t,!0)}_buttonUp(t){this._processButtonEvent(t,!1)}_processButtonInputEvent(t,e,s=z.input[t]){const i={button:s,mapped:t};e===!0?this.emit("buttonDown",i):this.emit("buttonUp",i),t!=="none"&&(this._inputs[t]=e,this.emit(t,e))}_getButtonInputFromButton(t){return this._assignmentToButtonCache.do(t,()=>{const e=z.input.keys;for(const s in e)if(Object.prototype.hasOwnProperty.call(e,s)&&e[s]===t)return s;return"none"})}_processButtonEvent(t,e){if(this._buttons[t]===e)return;this._buttons[t]=e;const s=this._getButtonInputFromButton(t);this._processButtonInputEvent(s,e,t)}_cameraMove(t){this._inputs.camera={movement:new C(t),position:new C(this._inputs.camera.position).add(t)},this.emit("camera",this._inputs.camera)}_mouseMove(t){this._inputs.mouse={movement:new C([t.movementX,t.movementY]),position:new C([t.clientX,t.clientY])},this._mouseLocked===!0&&this._cameraMove(this._inputs.mouse.movement),this.emit("mouse",this._inputs.mouse)}lockPointer(){this._element.requestPointerLock()}unlockPointer(){this._document.exitPointerLock()}getButtonDown(t){return this._buttons[t]===!0}getInput(t){const e=this._inputs[t];return e===void 0?!1:e}_removeEvents(){}}class ue{constructor(t,e,s,i){this._canvas=t,this._ticker=e,this._assets=s,this._room=i,this._canvasContext=this._canvas.getContext("webgl"),this.camera=new re,this._resolution=1,this._room.world.add(this.camera)}set resolution(t){this._resolution=t,this.updateSize()}get resolution(){return this._resolution}setupRenderer(){D("dbug","setting up renderer..."),this._renderer=new Wt({context:this._canvasContext,antialias:!1}),D("dbug","done setting up renderer.")}async start(){return this.setupRenderer(),this.updateSize(),this._room.world.rendererObject.background=new Ht(2236962),this._ticker.on("tick",this._frameTick.bind(this)),this}_frameTick(t){this._renderer.render(this._room.world.rendererObject,this.camera.rendererObject)}updateSize(){const t=innerWidth*this._resolution,e=innerHeight*this._resolution;return this._canvas.width=t,this._canvas.height=e,this._renderer.setSize(t,e),this.camera.aspect=t/e,this.camera.updateProjectionMatrix(),this}}class de{constructor(t){this._assets=t,this.assets={models:{},images:{}}}async loadAssets(t){await this._loadAssets(t)}async _loadAssets(t){D("dbug","loading assets...");function e(r,u){let m=0,h=0;for(const _ of s)_.loaded>_.total?(m+=_.total,D("warn",`an asset's amount loaded is more than its total! (${_.loaded}/${_.total})`)):m+=_.loaded,h+=_.total;t==null||t(m,h,"Downloading assets",`${u} ${r}`)}const s=[],i=this._assets.models;for(const r in i)if(Object.prototype.hasOwnProperty.call(i,r)){const u=i[r],m=Xt.extname(u);let h;switch(m){case".gltf":h=Yt}if(h!==void 0){const _=new h,p={promise:Promise.resolve(),loaded:0,total:0};p.promise=_.loadAsync(u,l=>{p.loaded=l.loaded,p.total=l.total,e("model",m)}),p.promise.then(l=>{this.assets.models[r]=l}),s.push(p)}else{const _=new Error(`Unknown file type ${m} (${r})`);throw D("err!",_.message),_}}const o=s.map(r=>r.promise);await Promise.all(o),D("dbug","done loading assets",this.assets)}}class _e{constructor(){this.world=new he}}function Et(n,t,e){const s=n.slice();return s[7]=t[e],s}function Lt(n,t,e){const s=n.slice();return s[10]=t[e],s[12]=e,s}function It(n){let t,e,s,i,o,r,u,m=n[1],h=[];for(let a=0;a<m.length;a+=1)h[a]=Ot(Lt(n,m,a));const _=a=>R(h[a],1,1,()=>{h[a]=null});let p=n[0]?n[3]:n[4],l=[];for(let a=0;a<p.length;a+=1)l[a]=jt(Et(n,p,a));return{c(){t=T("div"),e=T("div");for(let a=0;a<h.length;a+=1)h[a].c();s=I(),i=T("div");for(let a=0;a<l.length;a+=1)l[a].c();this.h()},l(a){t=S(a,"DIV",{class:!0});var d=y(t);e=S(d,"DIV",{class:!0});var c=y(e);for(let g=0;g<h.length;g+=1)h[g].l(c);c.forEach(f),s=O(d),i=S(d,"DIV",{class:!0});var w=y(i);for(let g=0;g<l.length;g+=1)l[g].l(w);w.forEach(f),d.forEach(f),this.h()},h(){x(e,"class","panels svelte-1xg1opo"),x(i,"class","text svelte-1xg1opo"),x(t,"class",o="container "+(n[0]?"":"hidden")+" svelte-1xg1opo")},m(a,d){L(a,t,d),k(t,e);for(let c=0;c<h.length;c+=1)h[c].m(e,null);k(t,s),k(t,i);for(let c=0;c<l.length;c+=1)l[c].m(i,null);u=!0},p(a,d){if(n=a,d&3){m=n[1];let c;for(c=0;c<m.length;c+=1){const w=Lt(n,m,c);h[c]?(h[c].p(w,d),P(h[c],1)):(h[c]=Ot(w),h[c].c(),P(h[c],1),h[c].m(e,null))}for(mt(),c=m.length;c<h.length;c+=1)_(c);pt()}if(d&25){p=n[0]?n[3]:n[4];let c;for(c=0;c<p.length;c+=1){const w=Et(n,p,c);l[c]?l[c].p(w,d):(l[c]=jt(w),l[c].c(),l[c].m(i,null))}for(;c<l.length;c+=1)l[c].d(1);l.length=p.length}(!u||d&1&&o!==(o="container "+(n[0]?"":"hidden")+" svelte-1xg1opo"))&&x(t,"class",o)},i(a){if(!u){for(let d=0;d<m.length;d+=1)P(h[d]);Jt(()=>{r||(r=ft(t,kt,{duration:200,easing:wt},!0)),r.run(1)}),u=!0}},o(a){h=h.filter(Boolean);for(let d=0;d<h.length;d+=1)R(h[d]);r||(r=ft(t,kt,{duration:200,easing:wt},!1)),r.run(0),u=!1},d(a){a&&f(t),gt(h,a),gt(l,a),a&&r&&r.end()}}}function Ot(n){let t,e,s,i,o,r;return e=new ne({props:{panel:n[10],compact:!n[0]}}),{c(){t=T("div"),J(e.$$.fragment),s=I(),this.h()},l(u){t=S(u,"DIV",{class:!0});var m=y(t);Z(e.$$.fragment,m),s=O(m),m.forEach(f),this.h()},h(){x(t,"class","panel "+(n[12]===0?"top":"")+" svelte-1xg1opo")},m(u,m){L(u,t,m),Q(e,t,null),k(t,s),i=!0,o||(r=qt(t,"click",n[6]),o=!0)},p(u,m){const h={};m&2&&(h.panel=u[10]),m&1&&(h.compact=!u[0]),e.$set(h)},i(u){i||(P(e.$$.fragment,u),i=!0)},o(u){R(e.$$.fragment,u),i=!1},d(u){u&&f(t),K(e),o=!1,r()}}}function jt(n){let t,e=n[7]+"",s;return{c(){t=T("span"),s=X(e),this.h()},l(i){t=S(i,"SPAN",{class:!0});var o=y(t);s=Y(o,e),o.forEach(f),this.h()},h(){x(t,"class","line svelte-1xg1opo")},m(i,o){L(i,t,o),k(t,s)},p(i,o){o&25&&e!==(e=i[7]+"")&&st(s,e)},d(i){i&&f(t)}}}function me(n){let t,e,s=n[2]&&It(n);return{c(){s&&s.c(),t=bt()},l(i){s&&s.l(i),t=bt()},m(i,o){s&&s.m(i,o),L(i,t,o),e=!0},p(i,[o]){i[2]?s?(s.p(i,o),o&4&&P(s,1)):(s=It(i),s.c(),P(s,1),s.m(t.parentNode,t)):s&&(mt(),R(s,1,1,()=>{s=null}),pt())},i(i){e||(P(s),e=!0)},o(i){R(s),e=!1},d(i){s&&s.d(i),i&&f(t)}}}function pe(n,t,e){let{open:s=!1}=t,{active:i=!1}=t,{panels:o=[]}=t,{text:r=[]}=t,{textClosed:u=[]}=t;function m(_){e(1,o=[...o,_])}const h=_=>{_.preventDefault(),e(0,s=!s)};return n.$$set=_=>{"open"in _&&e(0,s=_.open),"active"in _&&e(2,i=_.active),"panels"in _&&e(1,o=_.panels),"text"in _&&e(3,r=_.text),"textClosed"in _&&e(4,u=_.textClosed)},[s,o,i,r,u,m,h]}class fe extends G{constructor(t){super();W(this,t,pe,me,H,{open:0,active:2,panels:1,text:3,textClosed:4,addPanel:5})}get addPanel(){return this.$$.ctx[5]}}class Rt extends Pt{constructor(...t){super(...t);this._lowestThisSection=1/0,this._highestThisSection=0,this._TPSTicker=new A({method:B.Manual,rate:1e3}),this.showExtras=!0,this._updateText=!1,this._TPSTicker.start(),this.on("update",(e,s,i)=>{this._lowestThisSection>i?this._lowestThisSection=i:this._highestThisSection<i&&(this._highestThisSection=i),this._TPSTicker.manualCallback()}),this._TPSTicker.on("tick",()=>this.updateText())}updateText(){this.text="";function t(s){return typeof s=="number"?Math.floor(s):s}const e=`${t(this._lowestThisSection)}/${t(this._highestThisSection)}`;this.compactText=`${e} ${this.unit}`,this.text=`${e} ${this.unit}
(${t(this._min)} - ${t(this._max)})`,this._lowestThisSection=1/0,this._highestThisSection=0}}function ge(n){let t,e,s,i,o,r,u,m,h;i=new te({props:{show:n[4],info:n[2],percent:n[3],title:n[1],error:n[5]}});function _(a){n[14](a)}function p(a){n[15](a)}let l={text:n[9],textClosed:n[10]};return n[8]!==void 0&&(l.open=n[8]),n[7]!==void 0&&(l.active=n[7]),r=new fe({props:l}),n[13](r),U.push(()=>vt(r,"open",_)),U.push(()=>vt(r,"active",p)),{c(){t=T("main"),e=T("canvas"),s=I(),J(i.$$.fragment),o=I(),J(r.$$.fragment),this.h()},l(a){t=S(a,"MAIN",{class:!0});var d=y(t);e=S(d,"CANVAS",{id:!0,class:!0}),y(e).forEach(f),s=O(d),Z(i.$$.fragment,d),o=O(d),Z(r.$$.fragment,d),d.forEach(f),this.h()},h(){x(e,"id","canvas"),x(e,"class","svelte-1nlk8s4"),x(t,"class","svelte-1nlk8s4"),q(t,"noSelect",n[11])},m(a,d){L(a,t,d),k(t,e),n[12](e),k(t,s),Q(i,t,null),k(t,o),Q(r,t,null),h=!0},p(a,[d]){const c={};d&16&&(c.show=a[4]),d&4&&(c.info=a[2]),d&8&&(c.percent=a[3]),d&2&&(c.title=a[1]),d&32&&(c.error=a[5]),i.$set(c);const w={};d&512&&(w.text=a[9]),d&1024&&(w.textClosed=a[10]),!u&&d&256&&(u=!0,w.open=a[8],xt(()=>u=!1)),!m&&d&128&&(m=!0,w.active=a[7],xt(()=>m=!1)),r.$set(w),d&2048&&q(t,"noSelect",a[11])},i(a){h||(P(i.$$.fragment,a),P(r.$$.fragment,a),h=!0)},o(a){R(i.$$.fragment,a),R(r.$$.fragment,a),h=!1},d(a){a&&f(t),n[12](null),K(i),n[13](null),K(r)}}}function be(n,t,e){_t(()=>{});let s,i="Downloading webpage",o="",r=0,u=!0,m=!0,h=!1,_,p=!1,l=!1,a=["xyz: 0, 0, 0"],d=["0, 0, 0"];dt(()=>{(async()=>{const v=new oe(s);v.on("started",()=>{m!==!1&&(e(4,u=!1),e(1,i="Done"),e(2,o=""),m=!1)});function ht(b,E,N,et){m!==!1&&(e(3,r=b/E),e(1,i=N),e(2,o=et),D("dbug","loading update: "+i+((o!=null?o:!1)?` (${o})`:"")+` ${Math.floor(r)}%`))}try{await v.load(ht.bind(this)),await v.start(ht.bind(this))}catch(b){e(1,i="Failed"),e(2,o=`${b}`),m=!1,e(5,h=!0),D("err!","error loading/starting game:",b);return}Tt(b=>{switch(b.debug.stats.show){case at.No:e(7,p=!1),e(8,l=!1);break;case at.Collapsed:e(7,p=!0),e(8,l=!1);break;case at.Open:e(7,p=!0),e(8,l=!0);break}e(11,c=b.video.noSelect)});const tt=new Rt("Frame TPS","#0FF","#022"),lt=new Rt("Fixed TPS","#FF0","#220"),M=new Pt("Memory","#F0F","#202");_.addPanel(tt),_.addPanel(lt),_.addPanel(M),M.unit="MB";function ct(b){return Math.floor(1e3/b)}function zt(){if(performance.memory){M.update(performance.memory.usedJSHeapSize*1e-6),M.showExtras=!0;const b=performance.memory.usedJSHeapSize/performance.memory.jsHeapSizeLimit;M.dynamicMax=!0,M.unstable=b>.5,M.unstableText=`${Math.floor(b*100)}% usage`}else M.update(`???
No memory
support`),M.dynamicMax=!1,M.showExtras=!1}tt.dynamicMax=!0;function ut(b,E,N,et){b.update(ct(N),et),b.unstable=E!==N,b.unstableText=`faking ${ct(E)}TPS`}v.frameTicker.on("tick",(b,E)=>{ut(tt,b,E),e(9,a=v.debugText),e(10,d=v.debugTextShort)}),v.fixedTicker.on("tick",(b,E)=>{ut(lt,b,E,20),zt()})})()});let c=!1;function w(v){U[v?"unshift":"push"](()=>{s=v,e(0,s)})}function g(v){U[v?"unshift":"push"](()=>{_=v,e(6,_)})}function F(v){l=v,e(8,l)}function rt(v){p=v,e(7,p)}return[s,i,o,r,u,h,_,p,l,a,d,c,w,g,F,rt]}class we extends G{constructor(t){super();W(this,t,be,ge,H,{})}}function ke(n){let t,e,s;return e=new we({}),{c(){t=I(),J(e.$$.fragment),this.h()},l(i){Zt('[data-svelte="svelte-4vcxiu"]',document.head).forEach(f),t=O(i),Z(e.$$.fragment,i),this.h()},h(){document.title="..."},m(i,o){L(i,t,o),Q(e,i,o),s=!0},p:it,i(i){s||(P(e.$$.fragment,i),s=!0)},o(i){R(e.$$.fragment,i),s=!1},d(i){i&&f(t),K(e,i)}}}class Te extends G{constructor(t){super();W(this,t,null,ke,H,{})}}export{Te as default};
