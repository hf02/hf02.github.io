import{J as Rt,S as Y,i as G,s as W,e as x,t as H,c as S,a as y,g as J,d as g,b as k,f as C,P as T,h as it,j as P,l as L,N as I,U as q,V as nt,u as ut,W as dt,X as jt,Y as U,Z as zt,_ as Ot,$ as Bt,a0 as Ft,a1 as Ut,a2 as Nt,a3 as Vt,a4 as Xt,a5 as Yt,a6 as Gt,p as M,v as Z,w as Q,x as K,a7 as Wt,n as A,A as $,m as _t,o as mt,L as Ht,M as pt,a8 as gt,k as ft,Q as wt,R as bt,a9 as Tt,aa as vt,E as Jt}from"../chunks/vendor-c53312c6.js";import{T as tt,a as O,b as B,d as kt,S as N,V as qt,g as Zt,s as Qt,c as R,P as Kt,e as V,u as $t,C as te,l as j,f as ee,L as se,h as ot}from"../chunks/Player-d6f2fe04.js";function ie(n,t,e){return n.padEnd(e,t).slice(0,e)}function xt(n){let t,e,s,i;return{c(){t=x("div"),e=H("! "),s=H(n[7]),this.h()},l(a){t=S(a,"DIV",{class:!0});var r=y(t);e=J(r,"! "),s=J(r,n[7]),r.forEach(g),this.h()},h(){k(t,"class",i="unstable "+(n[5]?"cooldown":"")+" svelte-1cip8ko")},m(a,r){C(a,t,r),T(t,e),T(t,s)},p(a,r){r&128&&it(s,a[7]),r&32&&i!==(i="unstable "+(a[5]?"cooldown":"")+" svelte-1cip8ko")&&k(t,"class",i)},d(a){a&&g(t)}}}function ne(n){let t,e,s,i,a,r=(n[1]?n[3]:`${n[4]}
${n[3]}`)+"",u,m,h,_,p=(n[6]===!0||n[5]===!0)&&xt(n);return{c(){t=x("div"),e=x("div"),s=x("div"),i=P(),a=x("div"),u=H(r),m=P(),h=x("canvas"),_=P(),p&&p.c(),this.h()},l(l){t=S(l,"DIV",{class:!0,style:!0});var o=y(t);e=S(o,"DIV",{class:!0});var d=y(e);s=S(d,"DIV",{class:!0,style:!0}),y(s).forEach(g),i=L(d),a=S(d,"DIV",{class:!0});var c=y(a);u=J(c,r),c.forEach(g),d.forEach(g),m=L(o),h=S(o,"CANVAS",{class:!0}),y(h).forEach(g),_=L(o),p&&p.l(o),o.forEach(g),this.h()},h(){k(s,"class","text-background svelte-1cip8ko"),I(s,"background","linear-gradient(180deg, "+n[0].bg+" 35%, #00000000 100%)"),k(a,"class","text-content svelte-1cip8ko"),k(e,"class","text svelte-1cip8ko"),k(h,"class","svelte-1cip8ko"),k(t,"class","panel svelte-1cip8ko"),I(t,"background-color",n[0].bg),I(t,"border-color",n[0].fg),I(t,"color",n[0].fg),q(t,"compact",n[1])},m(l,o){C(l,t,o),T(t,e),T(e,s),T(e,i),T(e,a),T(a,u),T(t,m),T(t,h),n[8](h),T(t,_),p&&p.m(t,null)},p(l,[o]){o&1&&I(s,"background","linear-gradient(180deg, "+l[0].bg+" 35%, #00000000 100%)"),o&26&&r!==(r=(l[1]?l[3]:`${l[4]}
${l[3]}`)+"")&&it(u,r),l[6]===!0||l[5]===!0?p?p.p(l,o):(p=xt(l),p.c(),p.m(t,null)):p&&(p.d(1),p=null),o&1&&I(t,"background-color",l[0].bg),o&1&&I(t,"border-color",l[0].fg),o&1&&I(t,"color",l[0].fg),o&2&&q(t,"compact",l[1])},i:nt,o:nt,d(l){l&&g(t),n[8](null),p&&p.d()}}}class St extends tt{constructor(t,e,s){super();this.name=t,this.fg=e,this.bg=s,this._min=1/0,this._max=0,this.graph_x=0,this.graph_y=0,this.graph_width=100,this.graph_total_height=70,this.graph_deadzone=50,this.graph_non_deadzone=this.graph_total_height-this.graph_deadzone,this._updateText=!0,this.dynamicMax=!1,this._alreadyUpdatedDynamicMax=!1,this._currentDynamicMax=0,this._dynamicMaxTicker=new O({method:B.Manual,rate:1e4}),this._dynamicMaxStartTicker=new O({method:B.Manual,rate:1e3}),this.showExtras=!0,this._last=[],this._average=0,this._viewAverage=0,this.unit="",this.text="",this.compactText="",this._unstable=!1,this._unstableCooldown=!1,this._unstableText="",this.updateCanvas(),this._dynamicMaxTicker.on("tick",()=>this.updateDynamicTick()),this._dynamicMaxTicker.start(),this._dynamicMaxStartTicker.once("tick",()=>{this._dynamicMaxStartTicker.stop(),this.updateDynamicTick()}),this._dynamicMaxStartTicker.start()}updateSize(){this._pixelRatio=1,this._graph_x=this.graph_x*this._pixelRatio,this._graph_y=this.graph_y*this._pixelRatio,this._graph_width=this.graph_width*this._pixelRatio,this._graph_height=this.graph_deadzone*this._pixelRatio,this._graph_deadzone=this.graph_non_deadzone*this._pixelRatio,this._graph_deadzone_percent=this._graph_deadzone/(this._graph_height+this._graph_deadzone),this._canvas.width=this._graph_width,this._canvas.height=this.graph_total_height}updateCanvas(t=document.createElement("canvas")){this._canvas=t,this._context=this._canvas.getContext("2d"),this.updateSize()}rerenderAll(t=this._last,e=this._average){for(let s=0;s<t.length;s++){const i=t[s];this.render(i,e)}}render(t,e=this._average,s=this.fg,i=this.bg){if(typeof t=="number"){this._context.drawImage(this._canvas,this._graph_x+this._pixelRatio,this._graph_y,this._graph_width-this._pixelRatio,this._graph_height+this._graph_deadzone,this._graph_x,this._graph_y,this._graph_width-this._pixelRatio,this._graph_height+this._graph_deadzone),this._context.fillStyle=s;const a=Math.floor(t/e*(this._graph_height+this._graph_deadzone));this._context.fillRect(this._graph_x+this._graph_width-this._pixelRatio,this._graph_y,this._pixelRatio,this._graph_height+this._graph_deadzone);const r=a*this._graph_deadzone_percent;this._context.fillStyle=i,this._context.fillRect(this._graph_x+this._graph_width-this._pixelRatio,this._graph_y,this._pixelRatio,this._graph_height+this._graph_deadzone-r)}}updateDynamicTick(){this._currentDynamicMax=this._average,this._alreadyUpdatedDynamicMax=!0,this.dynamicMax===!0&&this.render(10,1,"#FFF")}update(t,e=this._currentDynamicMax){if(this._last.push(t),this._last.length>this._graph_width&&this._last.shift(),this._average=Math.round(Rt.mean(this._last)),this._viewAverage<this._average?this._viewAverage++:this._viewAverage>this._average&&this._viewAverage--,(this._alreadyUpdatedDynamicMax||!this.dynamicMax)&&this.render(t,e),typeof t=="number"&&(this._min=Math.min(this._min,t),this._max=Math.max(this._max,t)),this._dynamicMaxTicker.manualCallback(),this._dynamicMaxStartTicker.manualCallback(),this._updateText){let s=function(i){return typeof i=="number"?Math.floor(i):i};this.showExtras===!1?(this.text=`${s(t)}`,this.compactText=this.text):(this.compactText=`${s(t)} ${this.unit}`,this.text=`${s(t)} ${this.unit}
(${s(this._min)} - ${s(this._max)})`)}this.emit("update",this._min,this._max,t)}get unstable(){return this._unstable}set unstable(t){t===!1&&this._unstable===!0&&(this._unstableCooldown=!0,clearTimeout(this._unstableCooldownTimeout),this._unstableCooldownTimeout=setTimeout(()=>{this._unstableCooldown=!1},5e3)),t===!0&&(clearTimeout(this._unstableCooldownTimeout),this._unstableCooldown=!1),this._unstable=t}get unstableCooldown(){return this._unstableCooldown}set unstableText(t){this.unstable&&(this._unstableText=t)}get unstableText(){return this._unstableText}}function oe(n,t,e){let{panel:s}=t,i,a="",r="",u;const m=kt(f=>{const F=f.debug.stats.spinner;switch(F){case N.Braille:u=["\u2807","\u280B","\u2819","\u2838","\u2834","\u2826"];break;case N.Line:u=["/","-","\\","|"];break;case N.Number:u=["0","1","2","3","4","5","6","7","8","9"];break;case N.Wiggle:u=["<","(","|",")",">",")","|","("];break;case N.Run:u=["\u2514(\u141B)\u2510","\u250C(\u141B)\u2518"];break;default:u=F;break}});let h=0;function _(f,F,at){l?e(3,a=`${u[h%u.length]} ${s.compactText}`):e(3,a=`${u[h%u.length]} ${s.text}`),h++,e(4,r=s.name),e(6,d=s.unstable),e(7,c=s.unstableText),e(5,o=s.unstableCooldown)}ut(()=>{s.updateCanvas(i),_(),s.on("update",_)});function p(){s.removeListener("update",_),m(),e(0,s=null)}dt(p);let{compact:l=!1}=t,o=!1,d=!1,c="";function b(f){U[f?"unshift":"push"](()=>{i=f,e(2,i)})}return n.$$set=f=>{"panel"in f&&e(0,s=f.panel),"compact"in f&&e(1,l=f.compact)},n.$$.update=()=>{n.$$.dirty&1&&new jt(s.bg).alpha(.5).string()},[s,l,i,a,r,o,d,c,b]}class ae extends Y{constructor(t){super();G(this,t,oe,ne,W,{panel:0,compact:1})}}function yt(n,t,e=0){const s=Math.abs(n),i=s.toFixed();`${s}`.length-i.length;let a=i.length+e;const r=t;let u=!1;for(;a<r;){const h=s.toPrecision(a);if(h.length>=r){e===0&&h.indexOf(".")&&h.length>r&&(u=!0);break}a++}const m=n.toPrecision(a);return u?ie(m,"0",t):m}class z extends qt{constructor(t){super(t,2)}get x(){return this.getAxis(0)}set x(t){this.setAxis(0,t)}get y(){return this.getAxis(1)}set y(t){this.setAxis(1,t)}}class re extends tt{constructor(t){super();this._canvas=t,this.fixedTickerRate=1e3/20,this.maxDeltatime=1e3/19,this._crosshairShow=!1,this.inputController=new de(this._canvas,window,document,this),this._debugText=["..."],this._debugTextShort=["..."],this._lastButtonPressed=null,this._assets=new me({models:{player:"/assets/models/player.gltf"}}),this._room=new pe,this._loaded=!1,this._started=!1}get crosshairShow(){return this._crosshairShow}set crosshairShow(t){t!==this._crosshairShow&&(this._crosshairShow,this.emit("crosshairUpdate",this.crosshairShow))}get debugText(){return this._debugText}get debugTextShort(){return this._debugTextShort}_getDebugPosition(t,e=10){return t.map(s=>yt(s,e,3)).join(", ")}_getDebugRotation(t){return t.map(e=>yt(e*(180/Math.PI),10,3)).join(", ")}_updateDebugText(){const t=this._rendering.camera,e=this._player;this._debugTextShort=[`${e.position.axis.map(s=>Math.floor(s)).join(", ")}`],this._debugText=[`player pos: ${this._getDebugPosition(e.position.axis)}`,`(${this._getDebugRotation(e.head.rotation.axis)})`,`cam pos: ${this._getDebugPosition(t.position.axis)}`,` (${this._getDebugRotation(t.rotation.axis)})`,`${(()=>{let s="";for(const i of Et)s+=this.inputController.getInput(i)?ue[i]:"_";return s})()} ${this._lastButtonPressed}`,`${this.inputController.mouseLocked?"cam":"mus"} ${(()=>{const s=this.inputController.mouseLocked;let i="";return s?i+=this._getDebugPosition(this.inputController.getInput("camera").position.axis,7):i+=this._getDebugPosition(this.inputController.getInput("mouse").position.axis,7),i})()}`,...(()=>{const s=globalThis.ug13Watch,i=[];for(const a in s)if(Object.prototype.hasOwnProperty.call(s,a)){const r=s[a];i.push(`
    ${a}: ${r}`)}return i.unshift(`ug13Watch (${i.length}) = {`),i.push("}"),i})()]}get player(){return this._player}get loaded(){return this._loaded}get started(){return this._started}async load(t=()=>{}){t(0,2,"Loading settings","Checking"),await Zt(),t(1,2,"Loading settings","Saving"),await Qt(),t(2,2,"Loading settings","Done"),t(0,1,"Setting up some things",""),this.frameTicker=new O({maxDeltaTime:this.maxDeltatime,method:B.RequestAnimationFrame});const e=R.performance.fixedTickerUndershoot;return e!==0?(this.fixedTicker=new O({method:B.Manual,rate:this.fixedTickerRate,undershoot:e,maxDeltaTime:this.maxDeltatime}),this.frameTicker.on("tick",()=>this.fixedTicker.manualCallback())):this.fixedTicker=new O({method:B.SetInterval,rate:this.fixedTickerRate,undershoot:e,maxDeltaTime:this.maxDeltatime}),this._rendering=new _e(this._canvas,this.frameTicker,this._assets,this._room),t(1,1,"Setting up some things","Done"),await this._assets.loadAssets(t),this._player=new Kt(this._assets.assets.models.player,this._room.world,this.inputController,this._rendering.camera,this),this._loaded=!0,this.emit("loaded"),this}async start(t){if(t(0,2,"Starting"),this._loaded===!1)throw new Error("Game can't start if it's not loaded.");t(0,2,"Starting","Setting up renderer"),await this._rendering.start(),t(1,2,"Starting","Setting up some things"),this.inputController.on("action1",i=>{i===!0&&this.inputController.lockPointer()}),this.inputController.on("pause",i=>{i===!0&&this.inputController.unlockPointer()}),this.inputController.listen(),this.inputController.on("buttonDown",i=>{this._lastButtonPressed=i.button}),this.frameTicker.start().on("tick",this._frameTick.bind(this)),this.fixedTicker.start().on("tick",this._fixedTick.bind(this)),this._updateSize(),window.addEventListener("resize",this._updateSize.bind(this));const e=new V(new zt(16777215,1,50));return e.position.y=2,e.rendererObject.castShadow=!0,this._room.world.add(e),((i,a)=>{const r=new V(new Ot(new Bt(...a),new Ft({color:16777215})));r.position.set(i),r.rendererObject.castShadow=!0,r.rendererObject.receiveShadow=!0,this._room.world.add(r)})([0,-1,0],[10,1,10]),this.inputController.on("debug",i=>{i===!0&&(R.debug.stats.show++,R.debug.stats.show>2&&(R.debug.stats.show=0)),$t()}),t(2,2,"Starting","Done"),this._started=!0,this.emit("started"),this}async stop(){throw new Error("not implemented")}_updateSize(){this._rendering.updateSize()}_frameTick(t){this._updateDebugText(),this.emit("frameTick",t)}_fixedTick(t){this.emit("fixedTick",t)}_setup(){throw new Error("not implemented")}_loadAssets(){throw new Error("not implemented")}}class he extends V{constructor(){super(...arguments);this._rendererObject=new Ut,this._aspect=1}get rendererObject(){return this._rendererObject}get aspect(){return this._aspect}set aspect(t){this._aspect=t,this._rendererObject.aspect=this.aspect}updateProjectionMatrix(){this._rendererObject.updateProjectionMatrix()}}class le extends V{constructor(){super(...arguments);this._rendererObject=new Nt}get rendererObject(){return this._rendererObject}}class ce extends tt{constructor(t){super();this._element=t,this.ongoingTouches=[],this.ongoingTouchesDOM=[]}_setupEvents(){this._element.addEventListener("touchend",this._touchEndEvent.bind(this)),this._element.addEventListener("touchcancel",this._touchCancelEvent.bind(this)),this._element.addEventListener("touchmove",this._touchMoveEvent.bind(this)),this._element.addEventListener("touchstart",this._touchStartEvent.bind(this)),this.on("end",t=>this.emit("stop",t)),this.on("cancel",t=>this.emit("stop",t))}listen(){this._setupEvents()}_updateTouch(t,e){const s=this.ongoingTouches[t],i={id:t,rawTouch:e,movementX:s?e.clientX-s.rawTouch.clientX:0,movementY:s?e.clientY-s.rawTouch.clientY:0,posX:e.clientX,posY:e.clientY};return this.ongoingTouches[t]=i,this.ongoingTouchesDOM[e.identifier]=i,i}_deleteTouch(t){const e=this.ongoingTouches[t];return delete this.ongoingTouchesDOM[e.rawTouch.identifier],delete this.ongoingTouches[t],e}_createTouch(t){return this._updateTouch(this.ongoingTouches.length,t)}getDomId(t){var e;return(e=this.ongoingTouches[t])==null?void 0:e.rawTouch.identifier}getTouchControllerId(t){var e;return(e=this.ongoingTouchesDOM[t])==null?void 0:e.id}_touchStartEvent(t){t.preventDefault();for(let e=0;e<t.changedTouches.length;e++){const s=t.changedTouches[e];this.emit("start",this._createTouch(s))}}_touchEndEvent(t){t.preventDefault();for(let e=0;e<t.changedTouches.length;e++){const s=t.changedTouches[e];this.emit("end",this._deleteTouch(this.getTouchControllerId(s.identifier)))}}_touchCancelEvent(t){t.preventDefault();for(let e=0;e<t.changedTouches.length;e++){const s=t.changedTouches[e];this.emit("cancel",this._deleteTouch(this.getTouchControllerId(s.identifier)))}}_touchMoveEvent(t){t.preventDefault();for(let e=0;e<t.changedTouches.length;e++){const s=t.changedTouches[e];this.emit("move",this._updateTouch(this.getTouchControllerId(s.identifier),s))}}}const Et=["jump","use","action1","action2","moveForwards","moveBackwards","moveLeft","moveRight","lookUp","lookDown","lookLeft","lookRight","pause","debug","fullscreen","zoom","changePerspective"],ue={action1:"1",action2:"2",camera:"C",debug:"D",jump:"J",mouse:"M",moveBackwards:"v",moveForwards:"^",moveLeft:"<",moveRight:">",lookDown:"v",lookLeft:"<",lookRight:">",lookUp:"^",pause:"P",use:"E",fullscreen:"F",zoom:"Z",changePerspective:"P"};class de extends tt{constructor(t,e=window,s=document,i){super();this._element=t,this._window=e,this._document=s,this._game=i,this.touchController=new ce(this._element),this._cameraTouchId=null,this._mouseLocked=!1,this._inputs={mouse:{movement:new z,position:new z},camera:{movement:new z,position:new z}},this._assignmentToButtonCache=new te({},!1),this._buttons={}}get element(){return this._element}get window(){return this._window}get document(){return this._document}get cameraTouchId(){return this._cameraTouchId}listen(){var t;this._setupEvents(),this.touchController.listen(),this.touchController.on("start",e=>{this._cameraTouchId===null&&(this._cameraTouchId=e.id),this._pointerLockChange(!0)}),this.touchController.on("stop",e=>{e.id===this._cameraTouchId&&(this._cameraTouchId=null)}),this.touchController.on("move",e=>{e.id===this._cameraTouchId&&this._mouseMove(new z([e.movementX,e.movementY]).setMul(R.input.camera.touchSensitivity))}),(t=this._game)==null||t.on("frameTick",e=>{const s=new z,i=R.input.camera.keyboardSensitivity*e;this.getInput("lookDown")&&s.setAdd([0,i]),this.getInput("lookUp")&&s.setAdd([0,-i]),this.getInput("lookRight")&&s.setAdd([i,0]),this.getInput("lookLeft")&&s.setAdd([-i,0]),this._cameraMove(s)})}_setupEvents(){this._element.addEventListener("mousedown",this._mouseDown.bind(this)),this._element.addEventListener("mouseup",this._mouseUp.bind(this)),this._window.addEventListener("keydown",this._keyDown.bind(this)),this._window.addEventListener("keyup",this._keyUp.bind(this)),this._element.addEventListener("contextmenu",this._contextMenu.bind(this)),this._window.addEventListener("blur",this._unfocus.bind(this)),this._window.addEventListener("mousemove",this._mouseMoveEvent.bind(this)),this._document.addEventListener("pointerlockchange",this._pointerLockChangeEvent.bind(this))}get mouseLocked(){return this._mouseLocked}_pointerLockChangeEvent(t){this._pointerLockChange()}_pointerLockChange(t=this.document.pointerLockElement===this._element){this._mouseLocked=t,this.emit("mouseLock",t)}get inputs(){return this._inputs}_mouseNumberToString(t){return`Mouse${t}`}_mouseDown(t){t.preventDefault(),this._buttonDown(this._mouseNumberToString(t.button))}_contextMenu(t){return t.preventDefault(),!1}_unfocus(){for(const t in this._inputs)Object.prototype.hasOwnProperty.call(this._inputs,t)&&Et.includes(t)&&this._processButtonInputEvent(t,!1)}_mouseUp(t){t.preventDefault(),this._buttonUp(this._mouseNumberToString(t.button))}_keyDown(t){t.preventDefault(),this._buttonDown(t.code)}_keyUp(t){t.preventDefault(),this._buttonUp(t.code)}_buttonDown(t){this._processButtonEvent(t,!0)}_buttonUp(t){this._processButtonEvent(t,!1)}_processButtonInputEvent(t,e,s=R.input[t]){const i={button:s,mapped:t};e===!0?this.emit("buttonDown",i):this.emit("buttonUp",i),t!=="none"&&(this._inputs[t]=e,this.emit(t,e))}_getButtonInputFromButton(t){return this._assignmentToButtonCache.do(t,()=>{const e=R.input.keys;for(const s in e)if(Object.prototype.hasOwnProperty.call(e,s)&&e[s]===t)return s;return"none"})}_processButtonEvent(t,e){if(this._buttons[t]===e)return;this._buttons[t]=e;const s=this._getButtonInputFromButton(t);this._processButtonInputEvent(s,e,t)}_cameraMove(t){this._inputs.camera.movement.set(t),this._inputs.camera.position.setAdd(t),this.emit("camera",this._inputs.camera)}_mouseMoveEvent(t){this._mouseMove(new z([t.movementX,t.movementY]),new z([t.clientX,t.clientY]))}_mouseMove(t,e){this._inputs.mouse.movement.set(t),e?this._inputs.mouse.position.set(e):this._inputs.mouse.position.add(t),this._mouseLocked===!0&&this._cameraMove(this._inputs.mouse.movement),this.emit("mouse",this._inputs.mouse)}lockPointer(){this._element.requestPointerLock()}unlockPointer(){this._document.exitPointerLock()}getButtonDown(t){return this._buttons[t]===!0}getInput(t){const e=this._inputs[t];return e===void 0?!1:e}_removeEvents(){}}class _e{constructor(t,e,s,i){this._canvas=t,this._ticker=e,this._assets=s,this._room=i,this._canvasContext=this._canvas.getContext("webgl"),this.camera=new he,this._resolution=1,this._room.world.add(this.camera)}set resolution(t){this._resolution=t,this.updateSize()}get resolution(){return this._resolution}setupRenderer(){j("dbug","setting up renderer..."),this._renderer=new Vt({context:this._canvasContext,antialias:!1}),j("dbug","done setting up renderer.")}async start(){return this.setupRenderer(),this.updateSize(),this._room.world.rendererObject.background=new Xt(2236962),this._renderer.shadowMap.enabled=!0,this._ticker.on("tick",this._frameTick.bind(this)),this}_frameTick(t){this._renderer.render(this._room.world.rendererObject,this.camera.rendererObject)}updateSize(){const t=innerWidth*this._resolution,e=innerHeight*this._resolution;return this._canvas.width=t,this._canvas.height=e,this._renderer.setSize(t,e),this.camera.aspect=t/e,this.camera.updateProjectionMatrix(),this}}class me{constructor(t){this._assetsInput=t,this.assets={models:{},images:{}}}async loadAssets(t){await this._loadAssets(t)}async _loadAssets(t){j("dbug","loading assets...");function e(r,u){let m=0,h=0;for(const _ of s)_.loaded>_.total?(m+=_.total,j("warn",`an asset's amount loaded is more than its total! (${_.loaded}/${_.total})`)):m+=_.loaded,h+=_.total;t==null||t(m,h,"Downloading assets",`${u} ${r}`)}const s=[],i=this._assetsInput.models;for(const r in i)if(Object.prototype.hasOwnProperty.call(i,r)){const u=i[r],m=Yt.extname(u);let h;switch(m){case".gltf":h=Gt}if(h!==void 0){const _=new h,p={promise:async()=>{const l=await _.loadAsync(u,o=>{p.loaded=o.loaded,p.total=o.total,e("model",m)});return V.rendererObjectToJSON(l.scene)},loaded:0,total:0};typeof p.promise=="function"&&(p.promise=p.promise()),p.promise.then(l=>{this.assets.models[r]=l}),s.push(p)}else{const _=new Error(`Unknown file type ${m} (${r})`);throw j("err!",_.message),_}}const a=s.map(r=>r.promise);await Promise.all(a),ee("lmao",this.assets),j("dbug","done loading assets",this.assets)}}class pe{constructor(){this.world=new le}}function Mt(n,t,e){const s=n.slice();return s[7]=t[e],s}function Dt(n,t,e){const s=n.slice();return s[10]=t[e],s[12]=e,s}function Ct(n){let t,e,s,i,a,r,u,m=n[1],h=[];for(let o=0;o<m.length;o+=1)h[o]=Pt(Dt(n,m,o));const _=o=>A(h[o],1,1,()=>{h[o]=null});let p=n[0]?n[3]:n[4],l=[];for(let o=0;o<p.length;o+=1)l[o]=Lt(Mt(n,p,o));return{c(){t=x("div"),e=x("div");for(let o=0;o<h.length;o+=1)h[o].c();s=P(),i=x("div");for(let o=0;o<l.length;o+=1)l[o].c();this.h()},l(o){t=S(o,"DIV",{class:!0});var d=y(t);e=S(d,"DIV",{class:!0});var c=y(e);for(let f=0;f<h.length;f+=1)h[f].l(c);c.forEach(g),s=L(d),i=S(d,"DIV",{class:!0});var b=y(i);for(let f=0;f<l.length;f+=1)l[f].l(b);b.forEach(g),d.forEach(g),this.h()},h(){k(e,"class","panels svelte-1xg1opo"),k(i,"class","text svelte-1xg1opo"),k(t,"class",a="container "+(n[0]?"":"hidden")+" svelte-1xg1opo")},m(o,d){C(o,t,d),T(t,e);for(let c=0;c<h.length;c+=1)h[c].m(e,null);T(t,s),T(t,i);for(let c=0;c<l.length;c+=1)l[c].m(i,null);u=!0},p(o,d){if(n=o,d&3){m=n[1];let c;for(c=0;c<m.length;c+=1){const b=Dt(n,m,c);h[c]?(h[c].p(b,d),M(h[c],1)):(h[c]=Pt(b),h[c].c(),M(h[c],1),h[c].m(e,null))}for(_t(),c=m.length;c<h.length;c+=1)_(c);mt()}if(d&25){p=n[0]?n[3]:n[4];let c;for(c=0;c<p.length;c+=1){const b=Mt(n,p,c);l[c]?l[c].p(b,d):(l[c]=Lt(b),l[c].c(),l[c].m(i,null))}for(;c<l.length;c+=1)l[c].d(1);l.length=p.length}(!u||d&1&&a!==(a="container "+(n[0]?"":"hidden")+" svelte-1xg1opo"))&&k(t,"class",a)},i(o){if(!u){for(let d=0;d<m.length;d+=1)M(h[d]);Ht(()=>{r||(r=pt(t,bt,{duration:200,easing:wt},!0)),r.run(1)}),u=!0}},o(o){h=h.filter(Boolean);for(let d=0;d<h.length;d+=1)A(h[d]);r||(r=pt(t,bt,{duration:200,easing:wt},!1)),r.run(0),u=!1},d(o){o&&g(t),gt(h,o),gt(l,o),o&&r&&r.end()}}}function Pt(n){let t,e,s,i,a,r;return e=new ae({props:{panel:n[10],compact:!n[0]}}),{c(){t=x("div"),Z(e.$$.fragment),s=P(),this.h()},l(u){t=S(u,"DIV",{class:!0});var m=y(t);Q(e.$$.fragment,m),s=L(m),m.forEach(g),this.h()},h(){k(t,"class","panel "+(n[12]===0?"top":"")+" svelte-1xg1opo")},m(u,m){C(u,t,m),K(e,t,null),T(t,s),i=!0,a||(r=Wt(t,"click",n[6]),a=!0)},p(u,m){const h={};m&2&&(h.panel=u[10]),m&1&&(h.compact=!u[0]),e.$set(h)},i(u){i||(M(e.$$.fragment,u),i=!0)},o(u){A(e.$$.fragment,u),i=!1},d(u){u&&g(t),$(e),a=!1,r()}}}function Lt(n){let t,e=n[7]+"",s;return{c(){t=x("span"),s=H(e),this.h()},l(i){t=S(i,"SPAN",{class:!0});var a=y(t);s=J(a,e),a.forEach(g),this.h()},h(){k(t,"class","line svelte-1xg1opo")},m(i,a){C(i,t,a),T(t,s)},p(i,a){a&25&&e!==(e=i[7]+"")&&it(s,e)},d(i){i&&g(t)}}}function ge(n){let t,e,s=n[2]&&Ct(n);return{c(){s&&s.c(),t=ft()},l(i){s&&s.l(i),t=ft()},m(i,a){s&&s.m(i,a),C(i,t,a),e=!0},p(i,[a]){i[2]?s?(s.p(i,a),a&4&&M(s,1)):(s=Ct(i),s.c(),M(s,1),s.m(t.parentNode,t)):s&&(_t(),A(s,1,1,()=>{s=null}),mt())},i(i){e||(M(s),e=!0)},o(i){A(s),e=!1},d(i){s&&s.d(i),i&&g(t)}}}function fe(n,t,e){let{open:s=!1}=t,{active:i=!1}=t,{panels:a=[]}=t,{text:r=[]}=t,{textClosed:u=[]}=t;function m(_){e(1,a=[...a,_])}const h=_=>{_.preventDefault(),e(0,s=!s)};return n.$$set=_=>{"open"in _&&e(0,s=_.open),"active"in _&&e(2,i=_.active),"panels"in _&&e(1,a=_.panels),"text"in _&&e(3,r=_.text),"textClosed"in _&&e(4,u=_.textClosed)},[s,a,i,r,u,m,h]}class we extends Y{constructor(t){super();G(this,t,fe,ge,W,{open:0,active:2,panels:1,text:3,textClosed:4,addPanel:5})}get addPanel(){return this.$$.ctx[5]}}class It extends St{constructor(...t){super(...t);this._lowestThisSection=1/0,this._highestThisSection=0,this._TPSTicker=new O({method:B.Manual,rate:1e3}),this.showExtras=!0,this._updateText=!1,this._TPSTicker.start(),this.on("update",(e,s,i)=>{this._lowestThisSection>i?this._lowestThisSection=i:this._highestThisSection<i&&(this._highestThisSection=i),this._TPSTicker.manualCallback()}),this._TPSTicker.on("tick",()=>this.updateText())}updateText(){this.text="";function t(s){return typeof s=="number"?Math.floor(s):s}const e=`${t(this._lowestThisSection)}/${t(this._highestThisSection)}`;this.compactText=`${e} ${this.unit}`,this.text=`${e} ${this.unit}
(${t(this._min)} - ${t(this._max)})`,this._lowestThisSection=1/0,this._highestThisSection=0}}function be(n){let t,e,s,i,a,r,u,m,h;i=new se({props:{show:n[4],info:n[2],percent:n[3],title:n[1],error:n[5]}});function _(o){n[14](o)}function p(o){n[15](o)}let l={text:n[9],textClosed:n[10]};return n[8]!==void 0&&(l.open=n[8]),n[7]!==void 0&&(l.active=n[7]),r=new we({props:l}),n[13](r),U.push(()=>Tt(r,"open",_)),U.push(()=>Tt(r,"active",p)),{c(){t=x("main"),e=x("canvas"),s=P(),Z(i.$$.fragment),a=P(),Z(r.$$.fragment),this.h()},l(o){t=S(o,"MAIN",{class:!0});var d=y(t);e=S(d,"CANVAS",{id:!0,class:!0}),y(e).forEach(g),s=L(d),Q(i.$$.fragment,d),a=L(d),Q(r.$$.fragment,d),d.forEach(g),this.h()},h(){k(e,"id","canvas"),k(e,"class","svelte-1nlk8s4"),k(t,"class","svelte-1nlk8s4"),q(t,"noSelect",n[11])},m(o,d){C(o,t,d),T(t,e),n[12](e),T(t,s),K(i,t,null),T(t,a),K(r,t,null),h=!0},p(o,[d]){const c={};d&16&&(c.show=o[4]),d&4&&(c.info=o[2]),d&8&&(c.percent=o[3]),d&2&&(c.title=o[1]),d&32&&(c.error=o[5]),i.$set(c);const b={};d&512&&(b.text=o[9]),d&1024&&(b.textClosed=o[10]),!u&&d&256&&(u=!0,b.open=o[8],vt(()=>u=!1)),!m&&d&128&&(m=!0,b.active=o[7],vt(()=>m=!1)),r.$set(b),d&2048&&q(t,"noSelect",o[11])},i(o){h||(M(i.$$.fragment,o),M(r.$$.fragment,o),h=!0)},o(o){A(i.$$.fragment,o),A(r.$$.fragment,o),h=!1},d(o){o&&g(t),n[12](null),$(i),n[13](null),$(r)}}}function Te(n,t,e){dt(()=>{});let s,i="Downloading webpage",a="",r=0,u=!0,m=!0,h=!1,_,p=!1,l=!1,o=["xyz: 0, 0, 0"],d=["0, 0, 0"];ut(()=>{(async()=>{const v=new re(s);v.on("started",()=>{m!==!1&&(e(4,u=!1),e(1,i="Done"),e(2,a=""),m=!1)});function rt(w,D,X,st){m!==!1&&(e(3,r=w/D),e(1,i=X),e(2,a=st),j("dbug","loading update: "+i+((a!=null?a:!1)?` (${a})`:"")+` ${Math.floor(r*100)}%`))}try{await v.load(rt.bind(this)),await v.start(rt.bind(this))}catch(w){e(1,i="Failed"),e(2,a=`${w}`),m=!1,e(5,h=!0),j("err!","error loading/starting game:",w);return}kt(w=>{switch(w.debug.stats.show){case ot.No:e(7,p=!1),e(8,l=!1);break;case ot.Collapsed:e(7,p=!0),e(8,l=!1);break;case ot.Open:e(7,p=!0),e(8,l=!0);break}e(11,c=w.video.noSelect)});const et=new It("Frame TPS","#0FF","#022"),ht=new It("Fixed TPS","#FF0","#220"),E=new St("Memory","#F0F","#202");_.addPanel(et),_.addPanel(ht),_.addPanel(E),E.unit="MB";function lt(w){return Math.floor(1e3/w)}function At(){if(performance.memory){E.update(performance.memory.usedJSHeapSize*1e-6),E.showExtras=!0;const w=performance.memory.usedJSHeapSize/performance.memory.jsHeapSizeLimit;E.dynamicMax=!0,E.unstable=w>.5,E.unstableText=`${Math.floor(w*100)}% usage`}else E.update(`???
No memory
support`),E.dynamicMax=!1,E.showExtras=!1}et.dynamicMax=!0;function ct(w,D,X,st){w.update(lt(X),st),w.unstable=D!==X,w.unstableText=`faking ${lt(D)}TPS`}v.frameTicker.on("tick",(w,D)=>{ct(et,w,D),e(9,o=v.debugText),e(10,d=v.debugTextShort)}),v.fixedTicker.on("tick",(w,D)=>{ct(ht,w,D,20),At()})})()});let c=!1;function b(v){U[v?"unshift":"push"](()=>{s=v,e(0,s)})}function f(v){U[v?"unshift":"push"](()=>{_=v,e(6,_)})}function F(v){l=v,e(8,l)}function at(v){p=v,e(7,p)}return[s,i,a,r,u,h,_,p,l,o,d,c,b,f,F,at]}class ve extends Y{constructor(t){super();G(this,t,Te,be,W,{})}}function ke(n){let t,e,s;return e=new ve({}),{c(){t=P(),Z(e.$$.fragment),this.h()},l(i){Jt('[data-svelte="svelte-4vcxiu"]',document.head).forEach(g),t=L(i),Q(e.$$.fragment,i),this.h()},h(){document.title="..."},m(i,a){C(i,t,a),K(e,i,a),s=!0},p:nt,i(i){s||(M(e.$$.fragment,i),s=!0)},o(i){A(e.$$.fragment,i),s=!1},d(i){i&&g(t),$(e,i)}}}class ye extends Y{constructor(t){super();G(this,t,null,ke,W,{})}}export{ye as default};
